<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>For Cristal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
        }

        /* ============ STARRY BACKGROUND ============ */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            animation-delay: var(--delay);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* ============ SHOOTING STARS ============ */
        .shooting-star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
            animation: shoot var(--duration, 1s) linear forwards;
            transform: rotate(var(--angle, 35deg));
        }

        .shooting-star::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: var(--tail-length, 80px);
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.9));
            right: 100%;
        }

        @keyframes shoot {
            0% {
                opacity: 1;
                transform: rotate(var(--angle, 35deg)) translateX(0);
            }
            80% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: rotate(var(--angle, 35deg)) translateX(var(--distance, 400px));
            }
        }

        /* ============ MOON ============ */
        .moon {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #fef9c3 0%, #fde68a 100%);
            border-radius: 50%;
            box-shadow:
                0 0 40px rgba(254, 249, 195, 0.5),
                0 0 80px rgba(254, 249, 195, 0.3),
                inset -10px -10px 20px rgba(251, 191, 36, 0.3);
            animation: moonGlow 4s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(254, 249, 195, 0.5), 0 0 80px rgba(254, 249, 195, 0.3), inset -10px -10px 20px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 0 60px rgba(254, 249, 195, 0.7), 0 0 100px rgba(254, 249, 195, 0.4), inset -10px -10px 20px rgba(251, 191, 36, 0.3); }
        }

        /* ============ SOUND TOGGLE ============ */
        .sound-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 30, 50, 0.8);
            border: 2px solid rgba(192, 132, 252, 0.4);
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            border-color: rgba(244, 114, 182, 0.6);
            box-shadow: 0 4px 20px rgba(244, 114, 182, 0.3);
        }

        .sound-toggle.off {
            opacity: 0.6;
        }

        /* ============ SCENES ============ */
        .scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        .scene.active {
            opacity: 1;
            pointer-events: all;
        }

        /* ============ TITLE SCREEN ============ */
        #title-screen {
            text-align: center;
            padding: 20px;
        }

        .title-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid rgba(255, 182, 193, 0.6);
            box-shadow: 0 0 30px rgba(255, 182, 193, 0.4);
            margin-bottom: 30px;
            object-fit: cover;
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .title-photo span {
            font-size: 40px;
        }

        .main-title {
            font-size: clamp(1.8rem, 6vw, 2.8rem);
            color: #fce7f3;
            text-shadow: 0 0 20px rgba(252, 231, 243, 0.5);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: #c4b5fd;
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* Floating Z's */
        .zzz-container {
            position: absolute;
            top: 20%;
            left: 15%;
        }

        .zzz {
            font-size: 24px;
            color: #c4b5fd;
            opacity: 0;
            animation: floatZ 3s ease-in-out infinite;
        }

        .zzz:nth-child(1) { animation-delay: 0s; }
        .zzz:nth-child(2) { animation-delay: 1s; font-size: 20px; }
        .zzz:nth-child(3) { animation-delay: 2s; font-size: 16px; }

        @keyframes floatZ {
            0% { opacity: 0; transform: translate(0, 0) rotate(-10deg); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translate(30px, -60px) rotate(10deg); }
        }

        .start-btn {
            padding: 18px 50px;
            font-size: 1.3rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #f472b6 0%, #c084fc 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(244, 114, 182, 0.4);
            transition: all 0.3s ease;
            animation: btnPulse 2s ease-in-out infinite;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(244, 114, 182, 0.6);
        }

        @keyframes btnPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        /* ============ GAME SCREEN ============ */
        #game-screen {
            justify-content: flex-end;
            padding-bottom: 0;
        }

        .progress-counter {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: #e9d5ff;
            background: rgba(30, 30, 50, 0.8);
            padding: 10px 25px;
            border-radius: 30px;
            border: 2px solid rgba(192, 132, 252, 0.3);
        }

        /* Fence and Ground */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(180deg, #1e3a1e 0%, #0f2010 100%);
            border-top: 3px solid #2d5a2d;
        }

        .fence {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
            z-index: 5;
        }

        .fence-post {
            width: 15px;
            height: 100px;
            background: linear-gradient(90deg, #8b5a2b 0%, #a0522d 50%, #8b5a2b 100%);
            border-radius: 3px;
            position: relative;
        }

        .fence-post::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 15px;
            background: linear-gradient(180deg, #a0522d 0%, #8b5a2b 100%);
            border-radius: 5px 5px 0 0;
        }

        .fence-rail {
            position: absolute;
            left: -20px;
            width: calc(100% + 40px);
            height: 12px;
            background: linear-gradient(180deg, #a0522d 0%, #8b5a2b 100%);
            border-radius: 3px;
        }

        .fence-rail.top { top: 15px; }
        .fence-rail.bottom { top: 55px; }

        /* ============ SHEEP ============ */
        .sheep-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .sheep-container {
            position: absolute;
            z-index: 10;
            cursor: pointer;
            pointer-events: auto;
            animation: var(--animation-name, sheepJumpLeft) var(--duration, 2.5s) var(--easing, ease-in-out) forwards;
        }

        .sheep-container:hover {
            filter: brightness(1.1);
        }

        /* Pattern 1: Classic left to right arc */
        @keyframes sheepJumpLeft {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            50% { left: 50%; bottom: var(--peak-y, 65%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 2: Right to left */
        @keyframes sheepJumpRight {
            0% { right: -150px; left: auto; bottom: var(--start-y, 25%); }
            50% { right: 50%; left: auto; bottom: var(--peak-y, 65%); }
            100% { right: calc(100% + 150px); left: auto; bottom: var(--end-y, 25%); }
        }

        /* Pattern 3: High bouncy arc */
        @keyframes sheepBounce {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            25% { left: 25%; bottom: var(--peak-y, 75%); }
            40% { left: 40%; bottom: calc(var(--peak-y, 75%) - 20%); }
            60% { left: 60%; bottom: var(--peak-y, 75%); }
            75% { left: 75%; bottom: calc(var(--peak-y, 75%) - 15%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 4: Low fast dash */
        @keyframes sheepDash {
            0% { left: -150px; bottom: var(--start-y, 30%); }
            20% { left: 15%; bottom: calc(var(--start-y, 30%) + 15%); }
            80% { left: 85%; bottom: calc(var(--end-y, 30%) + 15%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 30%); }
        }

        /* Pattern 5: Zigzag */
        @keyframes sheepZigzag {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            25% { left: 20%; bottom: var(--peak-y, 70%); }
            50% { left: 50%; bottom: var(--start-y, 30%); }
            75% { left: 80%; bottom: var(--peak-y, 70%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 6: Slow floaty */
        @keyframes sheepFloat {
            0% { left: -150px; bottom: var(--start-y, 40%); }
            30% { left: 25%; bottom: calc(var(--peak-y, 60%) + 5%); }
            50% { left: 50%; bottom: var(--peak-y, 60%); }
            70% { left: 75%; bottom: calc(var(--peak-y, 60%) - 5%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 40%); }
        }

        .sheep {
            position: relative;
            width: 120px;
            height: 90px;
            transform: scale(var(--size, 1)) scaleX(var(--flip, 1));
        }

        .sheep svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
        }

        /* Gentle bobbing animation for the sheep */
        .sheep-container:not(.caught) .sheep {
            animation: sheepBob 0.5s ease-in-out infinite;
        }

        @keyframes sheepBob {
            0%, 100% { transform: scale(var(--size, 1)) scaleX(var(--flip, 1)) translateY(0) rotate(-3deg); }
            50% { transform: scale(var(--size, 1)) scaleX(var(--flip, 1)) translateY(-8px) rotate(3deg); }
        }

        /* Sheep Click Effect */
        .sheep-container.caught {
            animation: sheepPoof 0.4s ease forwards !important;
        }

        @keyframes sheepPoof {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.8; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* Escaped sheep - fades as it leaves */
        .sheep-container.escaped {
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        /* Hearts burst effect */
        .hearts-burst {
            position: absolute;
            top: 50%;
            left: 50%;
            pointer-events: none;
        }

        .burst-heart {
            position: absolute;
            font-size: 24px;
            animation: burstOut 1s ease-out forwards;
        }

        @keyframes burstOut {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1); opacity: 0; }
        }

        /* ============ MESSAGE CARD ============ */
        .message-card {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%) translateY(50px);
            background: rgba(30, 30, 50, 0.95);
            border: 2px solid rgba(244, 114, 182, 0.4);
            border-radius: 20px;
            padding: 30px 40px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 20;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .message-card.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .message-text {
            font-size: 1.3rem;
            color: #fce7f3;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .next-btn {
            padding: 12px 35px;
            font-size: 1rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
        }

        /* ============ FINAL SCREEN ============ */
        #final-screen {
            text-align: center;
            padding: 20px;
        }

        .sleeping-sheep-pile {
            position: relative;
            width: 280px;
            height: 80px;
            margin-bottom: 30px;
        }

        .mini-sheep {
            position: absolute;
            filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.2));
        }

        .mini-sheep .sheep {
            animation: sleepyBob 3s ease-in-out infinite;
        }

        .mini-sheep:nth-child(2) .sheep { animation-delay: 0.5s; }
        .mini-sheep:nth-child(3) .sheep { animation-delay: 1s; }
        .mini-sheep:nth-child(4) .sheep { animation-delay: 1.5s; }
        .mini-sheep:nth-child(5) .sheep { animation-delay: 2s; }

        @keyframes sleepyBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .final-photo {
            width: 180px;
            height: 180px;
            border-radius: 20px;
            border: 4px solid rgba(255, 182, 193, 0.6);
            box-shadow: 0 0 40px rgba(255, 182, 193, 0.4);
            margin-bottom: 30px;
            object-fit: cover;
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .final-photo span {
            font-size: 60px;
        }

        .final-message {
            max-width: 500px;
            margin: 0 auto;
        }

        .final-title {
            font-size: clamp(1.5rem, 5vw, 2rem);
            color: #fce7f3;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .final-text {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #e9d5ff;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .promises {
            text-align: left;
            display: inline-block;
            margin-bottom: 25px;
        }

        .promise-item {
            font-size: 1.1rem;
            color: #c4b5fd;
            margin: 8px 0;
        }

        .final-signature {
            font-size: 1.4rem;
            color: #f9a8d4;
            font-weight: 600;
            margin-top: 20px;
        }

        .replay-btn {
            margin-top: 30px;
            padding: 10px 25px;
            font-size: 0.9rem;
            font-family: 'Quicksand', sans-serif;
            background: transparent;
            color: #a78bfa;
            border: 2px solid rgba(167, 139, 250, 0.4);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .replay-btn:hover {
            background: rgba(167, 139, 250, 0.2);
        }

        /* Floating Hearts Background */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            bottom: -50px;
            font-size: 20px;
            animation: floatUp 8s linear infinite;
            opacity: 0.6;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 600px) {
            .moon {
                width: 50px;
                height: 50px;
                top: 20px;
                right: 20px;
            }

            .fence {
                gap: 20px;
            }

            .fence-post {
                height: 70px;
                width: 12px;
            }

            .fence-rail {
                height: 10px;
            }

            .fence-rail.top { top: 10px; }
            .fence-rail.bottom { top: 40px; }

            .sheep {
                transform: scale(0.8);
            }

            .message-card {
                padding: 20px 25px;
                width: 90%;
            }

            .message-text {
                font-size: 1.1rem;
            }

            .title-photo, .final-photo {
                width: 100px;
                height: 100px;
            }

            .final-photo {
                width: 140px;
                height: 140px;
            }
        }
    </style>
</head>
<body>
    <!-- Stars Background -->
    <div class="stars-container" id="stars"></div>

    <!-- Moon -->
    <div class="moon"></div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()">
        <span id="sound-icon">ðŸ”Š</span>
    </button>

    <!-- ============ TITLE SCREEN ============ -->
    <div class="scene active" id="title-screen">
        <div class="zzz-container">
            <div class="zzz">Z</div>
            <div class="zzz">z</div>
            <div class="zzz">z</div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-photo.jpg"> -->
        <div class="title-photo">
            <span>ðŸ’‘</span>
        </div>

        <h1 class="main-title">A Bedtime Apology for Cristal</h1>
        <p class="subtitle">Tap to help me count my sorries...</p>

        <button class="start-btn" onclick="startGame()">Start</button>
    </div>

    <!-- ============ GAME SCREEN ============ -->
    <div class="scene" id="game-screen">
        <div class="progress-counter">
            <span id="sheep-count">0</span> of 8 sheep counted
        </div>

        <!-- Fence -->
        <div class="fence">
            <div class="fence-post">
                <div class="fence-rail top"></div>
                <div class="fence-rail bottom"></div>
            </div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
        </div>

        <!-- Ground -->
        <div class="ground"></div>

        <!-- Sheep spawn area (sheep created dynamically via JS) -->
        <div class="sheep-area" id="sheep-area"></div>

        <!-- Message Card -->
        <div class="message-card" id="message-card">
            <p class="message-text" id="message-text"></p>
            <button class="next-btn" onclick="nextSheep()">Next Sheep</button>
        </div>
    </div>

    <!-- ============ FINAL SCREEN ============ -->
    <div class="scene" id="final-screen">
        <div class="floating-hearts" id="floating-hearts"></div>

        <div class="sleeping-sheep-pile">
            <div class="mini-sheep" style="left: 0; top: 30px; transform: scale(0.4) rotate(-10deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 50px; top: 10px; transform: scale(0.45) rotate(5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 100px; top: 25px; transform: scale(0.38) rotate(-5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 150px; top: 15px; transform: scale(0.42) rotate(8deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 200px; top: 28px; transform: scale(0.4) rotate(-3deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-couple-photo.jpg"> -->
        <div class="final-photo">
            <span>ðŸ’•</span>
        </div>

        <div class="final-message">
            <h2 class="final-title">Cristal, mi amor...</h2>
            <p class="final-text">
                I'm so sorry you slept alone, cold and sad.
                <br>I never want you to feel that way again.
            </p>
            <div class="promises">
                <p class="promise-item">ðŸ”‹ I promise to always charge my phone</p>
                <p class="promise-item">ðŸ“± I promise to keep our call alive</p>
                <p class="promise-item">ðŸ’• I promise to be there when you wake up</p>
            </div>
            <p class="final-signature">Te amo siempre âœ¨</p>
        </div>

        <button class="replay-btn" onclick="replay()">Count sheep again?</button>
    </div>

    <script>
        // ============ CONFIGURATION ============
        const messages = [
            "Hour 1 alone... I'm so sorry my phone betrayed us ðŸ˜¢",
            "Hour 2... I tried calling you back, I promise I did ðŸ“±",
            "Hour 3... My heart was still on that call with you ðŸ’•",
            "Hour 4... Even in my sleep, I was reaching for you",
            "Hour 5... The night felt so empty without your breathing",
            "Hour 6... I dreamed we were still talking ðŸ’­",
            "Hour 7... Waking up without you online broke my heart",
            "Hour 8... Every minute apart made me miss you more ðŸ’—"
        ];

        // ============ STATE ============
        let sheepCaught = 0;           // Total sheep caught
        let gameStarted = false;
        let sheepIdCounter = 0;        // Unique ID for each sheep
        let activeSheep = new Map();   // Track active sheep on screen
        const TOTAL_SHEEP_NEEDED = 8;  // Sheep needed to win

        // ============ AUDIO SYSTEM ============
        let audioCtx = null;
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        let lullabyInterval = null;
        let ambientPlaying = false;
        let windNode = null;
        let windGain = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled);
            updateSoundIcon();
            if (soundEnabled) {
                initAudio();
                playPop();
                // Restart ambient sounds if game is in progress
                if (gameStarted) {
                    startAmbientSounds();
                }
            } else {
                stopLullaby();
                stopAmbientSounds();
            }
        }

        function updateSoundIcon() {
            const icon = document.getElementById('sound-icon');
            const btn = document.getElementById('sound-toggle');
            if (soundEnabled) {
                icon.textContent = 'ðŸ”Š';
                btn.classList.remove('off');
            } else {
                icon.textContent = 'ðŸ”‡';
                btn.classList.add('off');
            }
        }

        // Soft chime - bell/xylophone
        function playChime() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            [523.25, 659.25, 783.99].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.1);
                gain.gain.linearRampToValueAtTime(0.15, now + i * 0.1 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.8);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.1);
                osc.stop(now + i * 0.1 + 0.8);
            });
        }

        // Bouncy boing sound
        function playBoing() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, now);
            osc.frequency.exponentialRampToValueAtTime(150, now + 0.15);
            osc.frequency.exponentialRampToValueAtTime(200, now + 0.25);

            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.3);
        }

        // Cute sheep baa
        function playBaa() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Main bleat tone
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(220, now);
            osc.frequency.linearRampToValueAtTime(280, now + 0.1);
            osc.frequency.linearRampToValueAtTime(200, now + 0.3);

            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(800, now);

            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.15, now + 0.05);
            gain.gain.linearRampToValueAtTime(0.1, now + 0.2);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.4);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.4);
        }

        // Magical sparkle
        function playSparkle() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const notes = [880, 1108.73, 1318.51, 1567.98, 2093];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.05);
                gain.gain.linearRampToValueAtTime(0.08, now + i * 0.05 + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.05);
                osc.stop(now + i * 0.05 + 0.3);
            });
        }

        // Soft whoosh
        function playWhoosh() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const bufferSize = audioCtx.sampleRate * 0.3;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
            }

            const noise = audioCtx.createBufferSource();
            const filter = audioCtx.createBiquadFilter();
            const gain = audioCtx.createGain();

            noise.buffer = buffer;
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1000, now);
            filter.frequency.exponentialRampToValueAtTime(300, now + 0.3);
            filter.Q.setValueAtTime(1, now);

            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start(now);
        }

        // Quick pop
        function playPop() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);

            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.1);
        }

        // Celebration chord
        function playCelebration() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Warm major chord (C E G C)
            const freqs = [261.63, 329.63, 392.00, 523.25];
            freqs.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.12, now + 0.1);
                gain.gain.setValueAtTime(0.12, now + 0.8);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 2);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 2);
            });
        }

        // Gentle lullaby loop
        function startLullaby() {
            if (!soundEnabled || !audioCtx) return;

            // Pentatonic melody notes (C D E G A)
            const melody = [261.63, 293.66, 329.63, 392.00, 440.00, 392.00, 329.63, 293.66];
            let noteIndex = 0;

            function playNote() {
                if (!soundEnabled || !audioCtx) {
                    stopLullaby();
                    return;
                }
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(melody[noteIndex], now);

                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.06, now + 0.1);
                gain.gain.setValueAtTime(0.06, now + 0.4);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.8);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 0.8);

                noteIndex = (noteIndex + 1) % melody.length;
            }

            playNote();
            lullabyInterval = setInterval(playNote, 800);
        }

        function stopLullaby() {
            if (lullabyInterval) {
                clearInterval(lullabyInterval);
                lullabyInterval = null;
            }
        }

        // ============ AMBIENT SOUNDS ============
        // Cozy night atmosphere with soft breeze

        function startAmbientSounds() {
            if (!soundEnabled || !audioCtx || ambientPlaying) return;
            ambientPlaying = true;

            // Start soft wind/breeze
            startWind();
        }

        function stopAmbientSounds() {
            ambientPlaying = false;

            // Stop wind
            if (windGain) {
                const now = audioCtx ? audioCtx.currentTime : 0;
                windGain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                setTimeout(() => {
                    if (windNode) {
                        windNode.stop();
                        windNode = null;
                    }
                    windGain = null;
                }, 600);
            }
        }

        function startWind() {
            if (!soundEnabled || !audioCtx) return;

            // Create gentle wind using filtered noise
            const bufferSize = audioCtx.sampleRate * 4;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            // Create smooth noise
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }

            windNode = audioCtx.createBufferSource();
            windNode.buffer = buffer;
            windNode.loop = true;

            // Multiple filters for soft, dreamy wind
            const lowpass = audioCtx.createBiquadFilter();
            lowpass.type = 'lowpass';
            lowpass.frequency.setValueAtTime(400, audioCtx.currentTime);
            lowpass.Q.setValueAtTime(1, audioCtx.currentTime);

            const highpass = audioCtx.createBiquadFilter();
            highpass.type = 'highpass';
            highpass.frequency.setValueAtTime(100, audioCtx.currentTime);

            windGain = audioCtx.createGain();
            windGain.gain.setValueAtTime(0.001, audioCtx.currentTime);
            windGain.gain.exponentialRampToValueAtTime(0.025, audioCtx.currentTime + 2);

            // Gentle volume modulation for breathing wind effect
            const lfo = audioCtx.createOscillator();
            const lfoGain = audioCtx.createGain();
            lfo.type = 'sine';
            lfo.frequency.setValueAtTime(0.15, audioCtx.currentTime); // Very slow modulation
            lfoGain.gain.setValueAtTime(0.008, audioCtx.currentTime);

            lfo.connect(lfoGain);
            lfoGain.connect(windGain.gain);

            windNode.connect(lowpass);
            lowpass.connect(highpass);
            highpass.connect(windGain);
            windGain.connect(audioCtx.destination);

            windNode.start();
            lfo.start();
        }

        // ============ INITIALIZATION ============
        function init() {
            createStars();
            startShootingStars();
            updateSoundIcon();
        }

        function createStars() {
            const container = document.getElementById('stars');
            const starCount = 80;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 70 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                star.style.setProperty('--delay', (Math.random() * 5) + 's');
                container.appendChild(star);
            }
        }

        // ============ SHOOTING STARS ============
        function startShootingStars() {
            // Spawn a shooting star every 3-8 seconds
            function scheduleNext() {
                const delay = 3000 + Math.random() * 5000;
                setTimeout(() => {
                    createShootingStar();
                    scheduleNext();
                }, delay);
            }
            // Start with one after a short delay
            setTimeout(createShootingStar, 2000);
            scheduleNext();
        }

        function createShootingStar() {
            const container = document.getElementById('stars');
            const star = document.createElement('div');
            star.className = 'shooting-star';

            // Random starting position (upper-left portion of sky)
            star.style.left = (5 + Math.random() * 50) + '%';
            star.style.top = (5 + Math.random() * 25) + '%';

            // Random properties for variety
            const duration = 0.6 + Math.random() * 0.5;
            const distance = 300 + Math.random() * 300;
            const tailLength = 80 + Math.random() * 80;
            const angle = 25 + Math.random() * 30; // 25 to 55 degrees (diagonal down-right)

            star.style.setProperty('--duration', duration + 's');
            star.style.setProperty('--distance', distance + 'px');
            star.style.setProperty('--tail-length', tailLength + 'px');
            star.style.setProperty('--angle', angle + 'deg');

            container.appendChild(star);

            // Remove after animation completes
            setTimeout(() => star.remove(), duration * 1000 + 100);
        }

        // ============ GAME FLOW ============

        // Animation patterns with their properties
        const PATTERNS = [
            { name: 'sheepJumpLeft', duration: [2.5, 3.5], easing: 'ease-in-out', flip: 1 },
            { name: 'sheepJumpRight', duration: [2.5, 3.5], easing: 'ease-in-out', flip: -1 },
            { name: 'sheepBounce', duration: [3, 4], easing: 'ease-in-out', flip: 1 },
            { name: 'sheepDash', duration: [1.5, 2.2], easing: 'ease-out', flip: 1 },
            { name: 'sheepZigzag', duration: [3, 4], easing: 'linear', flip: 1 },
            { name: 'sheepFloat', duration: [3.5, 4.5], easing: 'ease-in-out', flip: 1 },
        ];

        let lastPatternIndex = -1; // Track last used pattern to avoid repeats

        function startGame() {
            initAudio();
            playChime();
            startAmbientSounds();
            document.getElementById('title-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            gameStarted = true;

            // Spawn first sheep
            setTimeout(spawnSheep, 500);
        }

        function spawnSheep() {
            if (!gameStarted || sheepCaught >= TOTAL_SHEEP_NEEDED) return;

            const sheepArea = document.getElementById('sheep-area');
            const sheepId = sheepIdCounter++;

            // Pick a random pattern (avoid repeating the same one)
            let patternIndex;
            do {
                patternIndex = Math.floor(Math.random() * PATTERNS.length);
            } while (patternIndex === lastPatternIndex && PATTERNS.length > 1);
            lastPatternIndex = patternIndex;

            const pattern = PATTERNS[patternIndex];

            // Randomize within the pattern's ranges
            const duration = pattern.duration[0] + Math.random() * (pattern.duration[1] - pattern.duration[0]);
            const startY = 22 + Math.random() * 10;    // 22-32%
            const peakY = 55 + Math.random() * 20;     // 55-75%
            const endY = 22 + Math.random() * 10;      // 22-32%
            const size = 0.85 + Math.random() * 0.3;   // 0.85-1.15 scale

            // Create sheep element
            const sheepContainer = document.createElement('div');
            sheepContainer.className = 'sheep-container';
            sheepContainer.dataset.sheepId = sheepId;

            // Set CSS custom properties
            sheepContainer.style.setProperty('--animation-name', pattern.name);
            sheepContainer.style.setProperty('--duration', duration + 's');
            sheepContainer.style.setProperty('--easing', pattern.easing);
            sheepContainer.style.setProperty('--start-y', startY + '%');
            sheepContainer.style.setProperty('--peak-y', peakY + '%');
            sheepContainer.style.setProperty('--end-y', endY + '%');
            sheepContainer.style.setProperty('--size', size);
            sheepContainer.style.setProperty('--flip', pattern.flip);

            // Sheep SVG
            sheepContainer.innerHTML = `
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="75" cy="35" rx="15" ry="13" fill="#fafafa"/>
                            <ellipse cx="90" cy="38" rx="12" ry="11" fill="#f0f0f0"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="75" cy="42" rx="16" ry="14" fill="#f8f8f8"/>
                            <ellipse cx="60" cy="55" rx="20" ry="14" fill="#f5f5f5"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="68" cy="30" rx="12" ry="10" fill="#fafafa"/>
                            <ellipse cx="80" cy="32" rx="10" ry="9" fill="#f8f8f8"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                            <ellipse cx="38" cy="38" rx="10" ry="9" fill="#fafafa"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <ellipse cx="105" cy="45" rx="7" ry="6" fill="#fafafa"/>
                        <g class="legs">
                            <path d="M78 62 L80 80 L76 80 L74 62" fill="#3d3d3d"/>
                            <ellipse cx="78" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M68 63 L70 80 L66 80 L64 63" fill="#3d3d3d"/>
                            <ellipse cx="68" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M52 60 L54 80 L50 80 L48 60" fill="#3d3d3d"/>
                            <ellipse cx="52" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M42 58 L44 78 L40 78 L38 58" fill="#3d3d3d"/>
                            <ellipse cx="42" cy="78" rx="3" ry="2" fill="#2d2d2d"/>
                        </g>
                        <g class="head">
                            <ellipse cx="18" cy="28" rx="8" ry="5" fill="#4a4a4a" transform="rotate(-30 18 28)"/>
                            <ellipse cx="38" cy="22" rx="8" ry="5" fill="#4a4a4a" transform="rotate(30 38 22)"/>
                            <ellipse cx="18" cy="28" rx="5" ry="3" fill="#ffb6c1" transform="rotate(-30 18 28)"/>
                            <ellipse cx="38" cy="22" rx="5" ry="3" fill="#ffb6c1" transform="rotate(30 38 22)"/>
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <ellipse cx="22" cy="28" rx="8" ry="6" fill="#fafafa"/>
                            <ellipse cx="34" cy="28" rx="8" ry="6" fill="#fafafa"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="28" cy="48" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M25 52 Q28 55 31 52" stroke="#2d2d2d" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        </g>
                    </svg>
                </div>
            `;

            // Click handler
            sheepContainer.addEventListener('click', () => catchSheep(sheepContainer, sheepId));

            // Track this sheep
            activeSheep.set(sheepId, sheepContainer);

            // Add to DOM
            sheepArea.appendChild(sheepContainer);
            playBoing();

            // Handle animation end (sheep escaped)
            sheepContainer.addEventListener('animationend', () => {
                if (!sheepContainer.classList.contains('caught')) {
                    sheepContainer.classList.add('escaped');
                    activeSheep.delete(sheepId);
                    setTimeout(() => {
                        sheepContainer.remove();
                        // Spawn next sheep after a short delay
                        if (gameStarted && sheepCaught < TOTAL_SHEEP_NEEDED) {
                            setTimeout(spawnSheep, 400);
                        }
                    }, 100);
                }
            });
        }

        function catchSheep(sheepElement, sheepId) {
            // Prevent double-catching
            if (sheepElement.classList.contains('caught') || sheepCaught >= TOTAL_SHEEP_NEEDED) return;

            // Get position BEFORE stopping animation
            const rect = sheepElement.getBoundingClientRect();

            // Fix the sheep's position where it was caught
            sheepElement.style.left = rect.left + 'px';
            sheepElement.style.top = rect.top + 'px';
            sheepElement.style.bottom = 'auto';
            sheepElement.style.right = 'auto';
            sheepElement.style.position = 'fixed';
            sheepElement.style.animation = 'sheepPoof 0.4s ease forwards';

            sheepElement.classList.add('caught');
            activeSheep.delete(sheepId);

            // Play sounds
            playBaa();
            setTimeout(playSparkle, 100);

            // Hearts burst at caught position
            createHeartsBurst(rect.left + rect.width/2, rect.top + rect.height/2);

            // Update count
            sheepCaught++;
            document.getElementById('sheep-count').textContent = sheepCaught;

            // Remove sheep after poof animation
            setTimeout(() => {
                sheepElement.remove();

                // Show message
                if (sheepCaught <= messages.length) {
                    showMessage(messages[sheepCaught - 1]);
                }
            }, 400);
        }


        function createHeartsBurst(x, y) {
            const hearts = ['ðŸ’•', 'ðŸ’—', 'ðŸ’–', 'âœ¨', 'ðŸ’œ', 'ðŸ¤'];
            const container = document.getElementById('game-screen');

            for (let i = 0; i < 10; i++) {
                const heart = document.createElement('div');
                heart.className = 'burst-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.position = 'fixed';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';

                const angle = (i / 10) * Math.PI * 2;
                const distance = 60 + Math.random() * 60;
                heart.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                heart.style.setProperty('--ty', Math.sin(angle) * distance + 'px');

                container.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            }
        }

        function showMessage(text) {
            const card = document.getElementById('message-card');
            const messageText = document.getElementById('message-text');
            messageText.textContent = text;
            card.classList.add('show');
            playWhoosh();
        }

        function nextSheep() {
            playPop();
            const card = document.getElementById('message-card');
            card.classList.remove('show');

            // Check if game is complete
            if (sheepCaught >= TOTAL_SHEEP_NEEDED) {
                setTimeout(showFinalScreen, 300);
            } else {
                // Spawn next sheep
                setTimeout(spawnSheep, 300);
            }
        }

        function showFinalScreen() {
            // Clear any remaining sheep
            document.getElementById('sheep-area').innerHTML = '';
            activeSheep.clear();

            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('final-screen').classList.add('active');
            createFloatingHearts();
            playCelebration();
            setTimeout(startLullaby, 2000);
        }

        function createFloatingHearts() {
            const container = document.getElementById('floating-hearts');
            const hearts = ['ðŸ’•', 'ðŸ’—', 'ðŸ’–', 'ðŸ’œ', 'ðŸ¤'];

            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 8 + 's';
                heart.style.fontSize = (15 + Math.random() * 15) + 'px';
                container.appendChild(heart);
            }
        }

        function replay() {
            // Stop sounds
            stopLullaby();
            stopAmbientSounds();
            playPop();

            // Clear sheep
            document.getElementById('sheep-area').innerHTML = '';
            activeSheep.clear();

            // Reset state
            sheepCaught = 0;
            gameStarted = false;
            sheepIdCounter = 0;
            lastPatternIndex = -1;
            document.getElementById('sheep-count').textContent = '0';
            document.getElementById('floating-hearts').innerHTML = '';

            // Hide message card if visible
            document.getElementById('message-card').classList.remove('show');

            // Switch screens
            document.getElementById('final-screen').classList.remove('active');
            document.getElementById('title-screen').classList.add('active');
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
