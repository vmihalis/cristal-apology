<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>For Cristal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
        }

        /* ============ STARRY BACKGROUND ============ */
        .stars-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            animation-delay: var(--delay);
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* ============ SHOOTING STARS ============ */
        .shooting-star {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 6px 2px rgba(255, 255, 255, 0.8);
            animation: shoot var(--duration, 1s) linear forwards;
            transform: rotate(var(--angle, 35deg));
        }

        .shooting-star::after {
            content: '';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: var(--tail-length, 80px);
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.6), rgba(255, 255, 255, 0.9));
            right: 100%;
        }

        @keyframes shoot {
            0% {
                opacity: 1;
                transform: rotate(var(--angle, 35deg)) translateX(0);
            }
            80% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: rotate(var(--angle, 35deg)) translateX(var(--distance, 400px));
            }
        }

        /* ============ MOON ============ */
        .moon {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #fef9c3 0%, #fde68a 100%);
            border-radius: 50%;
            box-shadow:
                0 0 40px rgba(254, 249, 195, 0.5),
                0 0 80px rgba(254, 249, 195, 0.3),
                inset -10px -10px 20px rgba(251, 191, 36, 0.3);
            animation: moonGlow 4s ease-in-out infinite;
            z-index: 1;
        }

        @keyframes moonGlow {
            0%, 100% { box-shadow: 0 0 40px rgba(254, 249, 195, 0.5), 0 0 80px rgba(254, 249, 195, 0.3), inset -10px -10px 20px rgba(251, 191, 36, 0.3); }
            50% { box-shadow: 0 0 60px rgba(254, 249, 195, 0.7), 0 0 100px rgba(254, 249, 195, 0.4), inset -10px -10px 20px rgba(251, 191, 36, 0.3); }
        }

        /* ============ SOUND TOGGLE ============ */
        .sound-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(30, 30, 50, 0.8);
            border: 2px solid rgba(192, 132, 252, 0.4);
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .sound-toggle:hover {
            transform: scale(1.1);
            border-color: rgba(244, 114, 182, 0.6);
            box-shadow: 0 4px 20px rgba(244, 114, 182, 0.3);
        }

        .sound-toggle.off {
            opacity: 0.6;
        }

        /* ============ SCENES ============ */
        .scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }

        .scene.active {
            opacity: 1;
            pointer-events: all;
        }

        /* ============ TITLE SCREEN ============ */
        #title-screen {
            text-align: center;
            padding: 20px;
        }

        .title-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 4px solid rgba(255, 182, 193, 0.6);
            box-shadow: 0 0 30px rgba(255, 182, 193, 0.4);
            margin-bottom: 30px;
            object-fit: cover;
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .title-photo span {
            font-size: 40px;
        }

        .main-title {
            font-size: clamp(1.8rem, 6vw, 2.8rem);
            color: #fce7f3;
            text-shadow: 0 0 20px rgba(252, 231, 243, 0.5);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .subtitle {
            font-size: clamp(1rem, 3vw, 1.3rem);
            color: #c4b5fd;
            margin-bottom: 40px;
            font-weight: 500;
        }

        /* Floating Z's */
        .zzz-container {
            position: absolute;
            top: 20%;
            left: 15%;
        }

        .zzz {
            font-size: 24px;
            color: #c4b5fd;
            opacity: 0;
            animation: floatZ 3s ease-in-out infinite;
        }

        .zzz:nth-child(1) { animation-delay: 0s; }
        .zzz:nth-child(2) { animation-delay: 1s; font-size: 20px; }
        .zzz:nth-child(3) { animation-delay: 2s; font-size: 16px; }

        @keyframes floatZ {
            0% { opacity: 0; transform: translate(0, 0) rotate(-10deg); }
            50% { opacity: 1; }
            100% { opacity: 0; transform: translate(30px, -60px) rotate(10deg); }
        }

        .start-btn {
            padding: 18px 50px;
            font-size: 1.3rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #f472b6 0%, #c084fc 100%);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(244, 114, 182, 0.4);
            transition: all 0.3s ease;
            animation: btnPulse 2s ease-in-out infinite;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 30px rgba(244, 114, 182, 0.6);
        }

        @keyframes btnPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        /* ============ GAME SCREEN ============ */
        #game-screen {
            justify-content: flex-end;
            padding-bottom: 0;
        }

        .progress-counter {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: #e9d5ff;
            background: rgba(30, 30, 50, 0.8);
            padding: 10px 25px;
            border-radius: 30px;
            border: 2px solid rgba(192, 132, 252, 0.3);
        }

        /* Fence and Ground */
        .ground {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 25%;
            background: linear-gradient(180deg, #1e3a1e 0%, #0f2010 100%);
            border-top: 3px solid #2d5a2d;
        }

        .fence {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
            z-index: 5;
        }

        .fence-post {
            width: 15px;
            height: 100px;
            background: linear-gradient(90deg, #8b5a2b 0%, #a0522d 50%, #8b5a2b 100%);
            border-radius: 3px;
            position: relative;
        }

        .fence-post::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 25px;
            height: 15px;
            background: linear-gradient(180deg, #a0522d 0%, #8b5a2b 100%);
            border-radius: 5px 5px 0 0;
        }

        .fence-rail {
            position: absolute;
            left: -20px;
            width: calc(100% + 40px);
            height: 12px;
            background: linear-gradient(180deg, #a0522d 0%, #8b5a2b 100%);
            border-radius: 3px;
        }

        .fence-rail.top { top: 15px; }
        .fence-rail.bottom { top: 55px; }

        /* ============ SHEEP ============ */
        .sheep-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
        }

        .sheep-container {
            position: absolute;
            z-index: 10;
            cursor: pointer;
            pointer-events: auto;
            animation: var(--animation-name, sheepJumpLeft) var(--duration, 2.5s) var(--easing, ease-in-out) forwards;
        }

        .sheep-container:hover {
            filter: brightness(1.1);
        }

        /* Pattern 1: Classic left to right arc */
        @keyframes sheepJumpLeft {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            50% { left: 50%; bottom: var(--peak-y, 65%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 2: Right to left */
        @keyframes sheepJumpRight {
            0% { right: -150px; left: auto; bottom: var(--start-y, 25%); }
            50% { right: 50%; left: auto; bottom: var(--peak-y, 65%); }
            100% { right: calc(100% + 150px); left: auto; bottom: var(--end-y, 25%); }
        }

        /* Pattern 3: High bouncy arc */
        @keyframes sheepBounce {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            25% { left: 25%; bottom: var(--peak-y, 75%); }
            40% { left: 40%; bottom: calc(var(--peak-y, 75%) - 20%); }
            60% { left: 60%; bottom: var(--peak-y, 75%); }
            75% { left: 75%; bottom: calc(var(--peak-y, 75%) - 15%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 4: Low fast dash */
        @keyframes sheepDash {
            0% { left: -150px; bottom: var(--start-y, 30%); }
            20% { left: 15%; bottom: calc(var(--start-y, 30%) + 15%); }
            80% { left: 85%; bottom: calc(var(--end-y, 30%) + 15%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 30%); }
        }

        /* Pattern 5: Zigzag */
        @keyframes sheepZigzag {
            0% { left: -150px; bottom: var(--start-y, 25%); }
            25% { left: 20%; bottom: var(--peak-y, 70%); }
            50% { left: 50%; bottom: var(--start-y, 30%); }
            75% { left: 80%; bottom: var(--peak-y, 70%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 25%); }
        }

        /* Pattern 6: Slow floaty */
        @keyframes sheepFloat {
            0% { left: -150px; bottom: var(--start-y, 40%); }
            30% { left: 25%; bottom: calc(var(--peak-y, 60%) + 5%); }
            50% { left: 50%; bottom: var(--peak-y, 60%); }
            70% { left: 75%; bottom: calc(var(--peak-y, 60%) - 5%); }
            100% { left: calc(100% + 150px); bottom: var(--end-y, 40%); }
        }

        .sheep {
            position: relative;
            width: 120px;
            height: 90px;
            transform: scale(var(--size, 1)) scaleX(var(--flip, 1));
        }

        .sheep svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
        }

        /* Gentle bobbing animation for the sheep */
        .sheep-container:not(.caught) .sheep {
            animation: sheepBob 0.5s ease-in-out infinite;
        }

        @keyframes sheepBob {
            0%, 100% { transform: scale(var(--size, 1)) scaleX(var(--flip, 1)) translateY(0) rotate(-3deg); }
            50% { transform: scale(var(--size, 1)) scaleX(var(--flip, 1)) translateY(-8px) rotate(3deg); }
        }

        /* Sheep Click Effect */
        .sheep-container.caught {
            animation: sheepPoof 0.4s ease forwards !important;
        }

        @keyframes sheepPoof {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.4); opacity: 0.8; }
            100% { transform: scale(0); opacity: 0; }
        }

        /* Escaped sheep - fades as it leaves */
        .sheep-container.escaped {
            opacity: 0.3;
            transition: opacity 0.3s;
        }

        /* Hearts burst effect */
        .hearts-burst {
            position: absolute;
            top: 50%;
            left: 50%;
            pointer-events: none;
        }

        .burst-heart {
            position: absolute;
            font-size: 24px;
            animation: burstOut 1s ease-out forwards;
        }

        @keyframes burstOut {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(1); opacity: 0; }
        }

        /* ============ MESSAGE CARD ============ */
        .message-card {
            position: absolute;
            bottom: 30%;
            left: 50%;
            transform: translateX(-50%) translateY(50px);
            background: rgba(30, 30, 50, 0.95);
            border: 2px solid rgba(244, 114, 182, 0.4);
            border-radius: 20px;
            padding: 30px 40px;
            max-width: 90%;
            width: 400px;
            text-align: center;
            opacity: 0;
            transition: all 0.5s ease;
            z-index: 20;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .message-card.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .message-text {
            font-size: 1.3rem;
            color: #fce7f3;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .next-btn {
            padding: 12px 35px;
            font-size: 1rem;
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            background: linear-gradient(135deg, #c084fc 0%, #a855f7 100%);
            color: white;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(168, 85, 247, 0.4);
        }

        /* ============ STAGE 2: PHONE CHARGING ============ */
        #phone-stage {
            background: linear-gradient(180deg, #0a0a12 0%, #12121f 50%, #0a0a12 100%);
        }

        .bedroom {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        /* Moonlight effect */
        .moonlight {
            position: absolute;
            top: 0;
            right: 0;
            width: 60%;
            height: 70%;
            background: radial-gradient(ellipse at top right, rgba(200, 210, 255, 0.08) 0%, transparent 60%);
            pointer-events: none;
        }

        /* Window */
        .bedroom-window {
            position: absolute;
            top: 10%;
            right: 10%;
            width: 120px;
            height: 150px;
            background: linear-gradient(180deg, #1a1a3a 0%, #252550 100%);
            border: 8px solid #2a2a3a;
            border-radius: 8px;
            box-shadow: inset 0 0 30px rgba(150, 170, 255, 0.1);
        }

        .bedroom-window::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 6px;
            background: #2a2a3a;
        }

        .bedroom-window::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 6px;
            background: #2a2a3a;
            transform: translateX(-50%);
        }

        .window-stars {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
        }

        .window-star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            border-radius: 50%;
            animation: twinkle 2s ease-in-out infinite;
        }

        /* Bed */
        .bed {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 120px;
        }

        .mattress {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 50px;
            background: linear-gradient(180deg, #3a3a5a 0%, #2a2a4a 100%);
            border-radius: 10px;
        }

        .blanket {
            position: absolute;
            bottom: 20px;
            width: 100%;
            height: 70px;
            background: linear-gradient(180deg, #6a5acd 0%, #5a4abd 100%);
            border-radius: 15px 15px 10px 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .pillow {
            position: absolute;
            bottom: 60px;
            left: 20px;
            width: 80px;
            height: 40px;
            background: linear-gradient(180deg, #e8e8f0 0%, #d0d0e0 100%);
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Sleeping character (you) */
        .sleeper {
            position: absolute;
            bottom: 55px;
            left: 60px;
            z-index: 2;
        }

        .sleeper-head {
            width: 45px;
            height: 45px;
            background: linear-gradient(180deg, #f5d0c5 0%, #e8c0b5 100%);
            border-radius: 50%;
            position: relative;
        }

        .sleeper-hair {
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            height: 30px;
            background: #3a3a4a;
            border-radius: 25px 25px 0 0;
        }

        .sleeper-eyes {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .sleeper-eye {
            width: 8px;
            height: 2px;
            background: #3a3a4a;
            border-radius: 2px;
        }

        .sleeper-zzz {
            position: absolute;
            top: -20px;
            right: -30px;
            font-size: 16px;
            color: #c4b5fd;
            opacity: 0;
            animation: floatZ 2s ease-in-out infinite;
        }

        .sleeper-zzz:nth-child(2) { animation-delay: 0.5s; right: -45px; top: -35px; font-size: 14px; }
        .sleeper-zzz:nth-child(3) { animation-delay: 1s; right: -55px; top: -50px; font-size: 12px; }

        /* Nightstand */
        .nightstand {
            position: absolute;
            bottom: 15%;
            right: 20%;
            width: 80px;
            height: 70px;
            background: linear-gradient(180deg, #4a4a5a 0%, #3a3a4a 100%);
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .nightstand-drawer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 20px;
            background: #3a3a4a;
            border-radius: 3px;
            border: 1px solid #2a2a3a;
        }

        .nightstand-drawer::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 15px;
            height: 4px;
            background: #5a5a6a;
            border-radius: 2px;
        }

        /* Phone on nightstand */
        .phone-on-stand {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 55px;
            background: linear-gradient(180deg, #1a1a2a 0%, #0a0a1a 100%);
            border-radius: 8px;
            border: 2px solid #2a2a3a;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .phone-screen-glow {
            width: 28px;
            height: 45px;
            background: linear-gradient(180deg, #4a90e2 0%, #357abd 100%);
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            box-shadow: 0 0 20px rgba(74, 144, 226, 0.4);
        }

        .phone-screen-glow.dying {
            animation: phoneDying 2s ease-out forwards;
        }

        .phone-screen-glow.dead {
            background: #1a1a2a;
            box-shadow: none;
        }

        @keyframes phoneDying {
            0% { background: linear-gradient(180deg, #4a90e2 0%, #357abd 100%); box-shadow: 0 0 20px rgba(74, 144, 226, 0.4); }
            30% { background: linear-gradient(180deg, #e24a4a 0%, #bd3535 100%); box-shadow: 0 0 20px rgba(226, 74, 74, 0.4); }
            60% { background: linear-gradient(180deg, #4a4a4a 0%, #2a2a2a 100%); box-shadow: 0 0 5px rgba(100, 100, 100, 0.2); }
            100% { background: #1a1a2a; box-shadow: none; }
        }

        .phone-battery-icon {
            font-size: 14px;
        }

        /* Wake up exclamation */
        .wake-up-alert {
            position: absolute;
            top: 30%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            color: #ff6b6b;
            opacity: 0;
            text-shadow: 0 0 30px rgba(255, 107, 107, 0.8);
            z-index: 20;
        }

        .wake-up-alert.show {
            animation: alertPop 0.5s ease-out forwards;
        }

        @keyframes alertPop {
            0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.3); }
            100% { opacity: 1; transform: translateX(-50%) scale(1); }
        }

        /* Search phase */
        .search-prompt {
            position: absolute;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.3rem;
            color: #e9d5ff;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            z-index: 20;
        }

        .search-prompt.show {
            opacity: 1;
        }

        .search-feedback {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.1rem;
            color: #f9a8d4;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 20;
        }

        .search-feedback.show {
            opacity: 1;
        }

        /* Searchable objects */
        .searchable {
            position: absolute;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .searchable:hover {
            filter: brightness(1.3);
        }

        .searchable.searched {
            pointer-events: none;
        }

        .searchable.searched::after {
            content: 'âœ—';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
            color: rgba(255, 100, 100, 0.8);
        }

        .searchable.found::after {
            content: 'âœ“';
            color: rgba(100, 255, 150, 0.9);
        }

        .search-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255, 255, 200, 0.3) 0%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            pointer-events: none;
        }

        .searchable:hover .search-glow {
            opacity: 1;
        }

        /* Desk lamp */
        .desk-lamp {
            bottom: calc(15% + 70px);
            right: calc(20% + 60px);
            width: 40px;
            height: 60px;
        }

        .lamp-base {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 8px;
            background: #5a5a6a;
            border-radius: 3px;
        }

        .lamp-stem {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 30px;
            background: #4a4a5a;
        }

        .lamp-shade {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 25px;
            background: linear-gradient(180deg, #8a7acc 0%, #6a5aaa 100%);
            border-radius: 5px 5px 15px 15px;
        }

        /* Book on floor */
        .floor-book {
            bottom: 8%;
            left: 25%;
            width: 50px;
            height: 35px;
            background: linear-gradient(90deg, #cc7a7a 0%, #aa5a5a 100%);
            border-radius: 3px;
            transform: rotate(-15deg);
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
        }

        .floor-book::before {
            content: '';
            position: absolute;
            left: 3px;
            top: 3px;
            bottom: 3px;
            width: 3px;
            background: rgba(255, 255, 255, 0.2);
        }

        /* Slippers */
        .slippers {
            bottom: 5%;
            left: 40%;
            width: 60px;
            height: 30px;
        }

        .slipper {
            position: absolute;
            width: 28px;
            height: 20px;
            background: linear-gradient(180deg, #7accc4 0%, #5aaaa2 100%);
            border-radius: 15px 15px 10px 10px;
        }

        .slipper:first-child { left: 0; transform: rotate(-10deg); }
        .slipper:last-child { right: 0; transform: rotate(5deg); }

        /* Plant */
        .plant {
            bottom: calc(15% + 70px);
            left: 15%;
            width: 50px;
            height: 70px;
        }

        .plant-pot {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 30px;
            background: linear-gradient(180deg, #cc9a6a 0%, #aa7a4a 100%);
            border-radius: 3px 3px 8px 8px;
        }

        .plant-leaves {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 35px;
        }

        /* Clothes pile */
        .clothes-pile {
            bottom: 10%;
            right: 10%;
            width: 60px;
            height: 40px;
            background: linear-gradient(180deg, #6a6acc 0%, #8a7acc 50%, #5a5aaa 100%);
            border-radius: 20px 25px 15px 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        /* Charger (hidden under nightstand) */
        .charger-spot {
            bottom: calc(15% - 15px);
            right: calc(20% + 20px);
            width: 50px;
            height: 25px;
        }

        .charger-cable {
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 8px;
            background: #2a2a3a;
            border-radius: 4px;
        }

        .charger-plug {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 15px;
            background: linear-gradient(180deg, #4a4a5a 0%, #3a3a4a 100%);
            border-radius: 3px;
        }

        /* ============ CHARGING PHASE ============ */
        .charging-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            z-index: 30;
        }

        .charging-screen.show {
            opacity: 1;
            pointer-events: all;
        }

        .big-phone {
            width: 180px;
            height: 320px;
            background: linear-gradient(180deg, #2a2a3a 0%, #1a1a2a 100%);
            border-radius: 25px;
            border: 4px solid #3a3a4a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .big-phone::before {
            content: '';
            position: absolute;
            top: 15px;
            width: 60px;
            height: 6px;
            background: #3a3a4a;
            border-radius: 3px;
        }

        .charging-icon {
            font-size: 50px;
            margin-bottom: 20px;
            animation: chargePulse 1.5s ease-in-out infinite;
        }

        @keyframes chargePulse {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.1); opacity: 1; }
        }

        .battery-visual {
            width: 80px;
            height: 140px;
            background: #1a1a2a;
            border: 3px solid #5a5a6a;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .battery-visual::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 8px;
            background: #5a5a6a;
            border-radius: 3px 3px 0 0;
        }

        .battery-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0%;
            background: linear-gradient(180deg, #4ade80 0%, #22c55e 100%);
            transition: height 0.3s ease;
        }

        .battery-fill.low {
            background: linear-gradient(180deg, #f87171 0%, #ef4444 100%);
        }

        .battery-percentage {
            font-size: 1.5rem;
            color: #e9d5ff;
            font-weight: 700;
        }

        .charging-message {
            position: absolute;
            bottom: 20%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.1rem;
            color: #c4b5fd;
            text-align: center;
            max-width: 300px;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .charging-message.show {
            opacity: 1;
        }

        .charging-cable {
            position: absolute;
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 50px;
            background: linear-gradient(180deg, #3a3a4a 0%, #2a2a3a 100%);
            border-radius: 4px;
        }

        .charging-cable::after {
            content: 'âš¡';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }

        /* ============ CALLING PHASE ============ */
        .calling-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
            z-index: 30;
        }

        .calling-screen.show {
            opacity: 1;
            pointer-events: all;
        }

        .call-phone {
            width: 200px;
            height: 360px;
            background: linear-gradient(180deg, #1a1a2a 0%, #0f0f1a 100%);
            border-radius: 30px;
            border: 4px solid #3a3a4a;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .call-phone::before {
            content: '';
            position: absolute;
            top: 15px;
            width: 60px;
            height: 6px;
            background: #3a3a4a;
            border-radius: 3px;
        }

        .contact-photo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, #f472b6 0%, #c084fc 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            margin-bottom: 20px;
            box-shadow: 0 0 30px rgba(244, 114, 182, 0.4);
        }

        .contact-name {
            font-size: 1.5rem;
            color: #fce7f3;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .call-status {
            font-size: 1rem;
            color: #a78bfa;
            margin-bottom: 30px;
            min-height: 24px;
        }

        .call-status.ringing {
            animation: ringPulse 1s ease-in-out infinite;
        }

        @keyframes ringPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .call-actions {
            display: flex;
            gap: 40px;
            margin-top: auto;
        }

        .call-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .call-btn.end-call {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .call-btn.retry-call {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }

        .call-btn:hover {
            transform: scale(1.1);
        }

        .no-answer-msg {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            color: #f9a8d4;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .no-answer-msg.show {
            opacity: 1;
        }

        /* Morning light transition */
        .morning-light {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, rgba(255, 200, 150, 0) 0%, rgba(255, 200, 150, 0) 100%);
            pointer-events: none;
            transition: background 3s ease;
            z-index: 5;
        }

        .morning-light.rising {
            background: linear-gradient(180deg, rgba(255, 200, 150, 0.15) 0%, rgba(255, 180, 130, 0.1) 50%, rgba(255, 200, 150, 0) 100%);
        }

        /* Stage 2 transition message */
        .stage-transition {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
        }

        .stage-transition.show {
            animation: fadeInOut 4s ease forwards;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .stage-transition-text {
            font-size: 1.5rem;
            color: #fce7f3;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.8);
            line-height: 1.8;
        }

        /* ============ FINAL SCREEN ============ */
        #final-screen {
            text-align: center;
            padding: 20px;
        }

        .sleeping-sheep-pile {
            position: relative;
            width: 280px;
            height: 80px;
            margin-bottom: 30px;
        }

        .mini-sheep {
            position: absolute;
            filter: drop-shadow(1px 2px 3px rgba(0,0,0,0.2));
        }

        .mini-sheep .sheep {
            animation: sleepyBob 3s ease-in-out infinite;
        }

        .mini-sheep:nth-child(2) .sheep { animation-delay: 0.5s; }
        .mini-sheep:nth-child(3) .sheep { animation-delay: 1s; }
        .mini-sheep:nth-child(4) .sheep { animation-delay: 1.5s; }
        .mini-sheep:nth-child(5) .sheep { animation-delay: 2s; }

        @keyframes sleepyBob {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .final-photo {
            width: 180px;
            height: 180px;
            border-radius: 20px;
            border: 4px solid rgba(255, 182, 193, 0.6);
            box-shadow: 0 0 40px rgba(255, 182, 193, 0.4);
            margin-bottom: 30px;
            object-fit: cover;
            background: linear-gradient(135deg, #2d2d44 0%, #1a1a2e 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .final-photo span {
            font-size: 60px;
        }

        .final-message {
            max-width: 500px;
            margin: 0 auto;
        }

        .final-title {
            font-size: clamp(1.5rem, 5vw, 2rem);
            color: #fce7f3;
            margin-bottom: 20px;
            font-weight: 700;
        }

        .final-text {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #e9d5ff;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        .promises {
            text-align: left;
            display: inline-block;
            margin-bottom: 25px;
        }

        .promise-item {
            font-size: 1.1rem;
            color: #c4b5fd;
            margin: 8px 0;
        }

        .final-signature {
            font-size: 1.4rem;
            color: #f9a8d4;
            font-weight: 600;
            margin-top: 20px;
        }

        .replay-btn {
            margin-top: 30px;
            padding: 10px 25px;
            font-size: 0.9rem;
            font-family: 'Quicksand', sans-serif;
            background: transparent;
            color: #a78bfa;
            border: 2px solid rgba(167, 139, 250, 0.4);
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .replay-btn:hover {
            background: rgba(167, 139, 250, 0.2);
        }

        /* Floating Hearts Background */
        .floating-hearts {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .floating-heart {
            position: absolute;
            bottom: -50px;
            font-size: 20px;
            animation: floatUp 8s linear infinite;
            opacity: 0.6;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* ============ RESPONSIVE ============ */
        @media (max-width: 600px) {
            .moon {
                width: 50px;
                height: 50px;
                top: 20px;
                right: 20px;
            }

            .fence {
                gap: 20px;
            }

            .fence-post {
                height: 70px;
                width: 12px;
            }

            .fence-rail {
                height: 10px;
            }

            .fence-rail.top { top: 10px; }
            .fence-rail.bottom { top: 40px; }

            .sheep {
                transform: scale(0.8);
            }

            .message-card {
                padding: 20px 25px;
                width: 90%;
            }

            .message-text {
                font-size: 1.1rem;
            }

            .title-photo, .final-photo {
                width: 100px;
                height: 100px;
            }

            .final-photo {
                width: 140px;
                height: 140px;
            }
        }
    </style>
</head>
<body>
    <!-- Stars Background -->
    <div class="stars-container" id="stars"></div>

    <!-- Moon -->
    <div class="moon"></div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()">
        <span id="sound-icon">ðŸ”Š</span>
    </button>

    <!-- ============ TITLE SCREEN ============ -->
    <div class="scene active" id="title-screen">
        <div class="zzz-container">
            <div class="zzz">Z</div>
            <div class="zzz">z</div>
            <div class="zzz">z</div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-photo.jpg"> -->
        <div class="title-photo">
            <span>ðŸ’‘</span>
        </div>

        <h1 class="main-title">A Bedtime Apology for Cristal</h1>
        <p class="subtitle">Tap to help me count my sorries...</p>

        <button class="start-btn" onclick="startGame()">Start</button>
    </div>

    <!-- ============ GAME SCREEN ============ -->
    <div class="scene" id="game-screen">
        <div class="progress-counter">
            <span id="sheep-count">0</span> of 8 sheep counted
        </div>

        <!-- Fence -->
        <div class="fence">
            <div class="fence-post">
                <div class="fence-rail top"></div>
                <div class="fence-rail bottom"></div>
            </div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
        </div>

        <!-- Ground -->
        <div class="ground"></div>

        <!-- Sheep spawn area (sheep created dynamically via JS) -->
        <div class="sheep-area" id="sheep-area"></div>

        <!-- Message Card -->
        <div class="message-card" id="message-card">
            <p class="message-text" id="message-text"></p>
            <button class="next-btn" onclick="nextSheep()">Next Sheep</button>
        </div>
    </div>

    <!-- ============ STAGE 2: PHONE CHARGING ============ -->
    <div class="scene" id="phone-stage">
        <div class="bedroom">
            <!-- Morning light overlay -->
            <div class="morning-light" id="morning-light"></div>

            <!-- Moonlight glow -->
            <div class="moonlight"></div>

            <!-- Window with stars -->
            <div class="bedroom-window">
                <div class="window-stars">
                    <div class="window-star" style="top: 20%; left: 30%;"></div>
                    <div class="window-star" style="top: 40%; left: 60%;"></div>
                    <div class="window-star" style="top: 15%; left: 80%;"></div>
                    <div class="window-star" style="top: 60%; left: 20%;"></div>
                    <div class="window-star" style="top: 70%; left: 70%;"></div>
                </div>
            </div>

            <!-- Bed with sleeper -->
            <div class="bed">
                <div class="mattress"></div>
                <div class="blanket"></div>
                <div class="pillow"></div>
                <div class="sleeper" id="sleeper">
                    <div class="sleeper-head">
                        <div class="sleeper-hair"></div>
                        <div class="sleeper-eyes">
                            <div class="sleeper-eye"></div>
                            <div class="sleeper-eye"></div>
                        </div>
                    </div>
                    <div class="sleeper-zzz">Z</div>
                    <div class="sleeper-zzz">z</div>
                    <div class="sleeper-zzz">z</div>
                </div>
            </div>

            <!-- Nightstand with phone -->
            <div class="nightstand">
                <div class="nightstand-drawer"></div>
                <div class="phone-on-stand" id="phone-on-stand">
                    <div class="phone-screen-glow" id="phone-screen">
                        <span class="phone-battery-icon">ðŸ”‹</span>
                    </div>
                </div>
            </div>

            <!-- Searchable objects -->
            <div class="searchable desk-lamp" data-item="lamp" id="search-lamp">
                <div class="lamp-shade"></div>
                <div class="lamp-stem"></div>
                <div class="lamp-base"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable floor-book" data-item="book" id="search-book">
                <div class="search-glow"></div>
            </div>

            <div class="searchable slippers" data-item="slippers" id="search-slippers">
                <div class="slipper"></div>
                <div class="slipper"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable plant" data-item="plant" id="search-plant">
                <div class="plant-leaves">ðŸŒ±</div>
                <div class="plant-pot"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable clothes-pile" data-item="clothes" id="search-clothes">
                <div class="search-glow"></div>
            </div>

            <div class="searchable charger-spot" data-item="charger" id="search-charger">
                <div class="charger-cable"></div>
                <div class="charger-plug"></div>
                <div class="search-glow"></div>
            </div>

            <!-- Wake up alert -->
            <div class="wake-up-alert" id="wake-up-alert">!! OH NO !!</div>

            <!-- Search prompt -->
            <div class="search-prompt" id="search-prompt">
                Find the charger! Tap around the room...
            </div>

            <!-- Search feedback -->
            <div class="search-feedback" id="search-feedback"></div>
        </div>

        <!-- Charging screen overlay -->
        <div class="charging-screen" id="charging-screen">
            <div class="big-phone">
                <div class="charging-icon">ðŸ”Œ</div>
                <div class="battery-visual">
                    <div class="battery-fill low" id="battery-fill"></div>
                </div>
                <div class="battery-percentage"><span id="battery-percent">0</span>%</div>
                <div class="charging-cable"></div>
            </div>
            <div class="charging-message" id="charging-message"></div>
        </div>

        <!-- Calling screen overlay -->
        <div class="calling-screen" id="calling-screen">
            <div class="call-phone">
                <div class="contact-photo">ðŸ’•</div>
                <div class="contact-name">Cristal</div>
                <div class="call-status" id="call-status">Calling...</div>
                <div class="call-actions">
                    <button class="call-btn end-call" id="end-call-btn" onclick="endCallAttempt()">ðŸ“µ</button>
                    <button class="call-btn retry-call" id="retry-call-btn" onclick="retryCall()" style="display: none;">ðŸ“ž</button>
                </div>
            </div>
            <div class="no-answer-msg" id="no-answer-msg"></div>
        </div>

        <!-- Stage transition message -->
        <div class="stage-transition" id="stage-transition">
            <p class="stage-transition-text" id="stage-transition-text"></p>
        </div>
    </div>

    <!-- ============ FINAL SCREEN ============ -->
    <div class="scene" id="final-screen">
        <div class="floating-hearts" id="floating-hearts"></div>

        <div class="sleeping-sheep-pile">
            <div class="mini-sheep" style="left: 0; top: 30px; transform: scale(0.4) rotate(-10deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 50px; top: 10px; transform: scale(0.45) rotate(5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 100px; top: 25px; transform: scale(0.38) rotate(-5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 150px; top: 15px; transform: scale(0.42) rotate(8deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 200px; top: 28px; transform: scale(0.4) rotate(-3deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-couple-photo.jpg"> -->
        <div class="final-photo">
            <span>ðŸ’•</span>
        </div>

        <div class="final-message">
            <h2 class="final-title">Cristal, mi amor...</h2>
            <p class="final-text">
                I'm so sorry you slept alone, cold and sad.
                <br>I never want you to feel that way again.
            </p>
            <div class="promises">
                <p class="promise-item">ðŸ”‹ I promise to always charge my phone</p>
                <p class="promise-item">ðŸ“± I promise to keep our call alive</p>
                <p class="promise-item">ðŸ’• I promise to be there when you wake up</p>
            </div>
            <p class="final-signature">Te amo siempre âœ¨</p>
        </div>

        <button class="replay-btn" onclick="replay()">Count sheep again?</button>
    </div>

    <script>
        // ============ CONFIGURATION ============
        const messages = [
            "Hour 1 alone... I'm so sorry my phone betrayed us ðŸ˜¢",
            "Hour 2... I tried calling you back, I promise I did ðŸ“±",
            "Hour 3... My heart was still on that call with you ðŸ’•",
            "Hour 4... Even in my sleep, I was reaching for you",
            "Hour 5... The night felt so empty without your breathing",
            "Hour 6... I dreamed we were still talking ðŸ’­",
            "Hour 7... Waking up without you online broke my heart",
            "Hour 8... Every minute apart made me miss you more ðŸ’—"
        ];

        // ============ STATE ============
        let sheepCaught = 0;           // Total sheep caught
        let gameStarted = false;
        let sheepIdCounter = 0;        // Unique ID for each sheep
        let activeSheep = new Map();   // Track active sheep on screen
        const TOTAL_SHEEP_NEEDED = 8;  // Sheep needed to win

        // ============ AUDIO SYSTEM ============
        let audioCtx = null;
        let soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
        let lullabyInterval = null;
        let ambientPlaying = false;
        let windNode = null;
        let windGain = null;

        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioCtx.state === 'suspended') {
                audioCtx.resume();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            localStorage.setItem('soundEnabled', soundEnabled);
            updateSoundIcon();
            if (soundEnabled) {
                initAudio();
                playPop();
                // Restart ambient sounds if game is in progress
                if (gameStarted) {
                    startAmbientSounds();
                }
            } else {
                stopLullaby();
                stopAmbientSounds();
            }
        }

        function updateSoundIcon() {
            const icon = document.getElementById('sound-icon');
            const btn = document.getElementById('sound-toggle');
            if (soundEnabled) {
                icon.textContent = 'ðŸ”Š';
                btn.classList.remove('off');
            } else {
                icon.textContent = 'ðŸ”‡';
                btn.classList.add('off');
            }
        }

        // Soft chime - bell/xylophone
        function playChime() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            [523.25, 659.25, 783.99].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.1);
                gain.gain.linearRampToValueAtTime(0.15, now + i * 0.1 + 0.05);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.8);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.1);
                osc.stop(now + i * 0.1 + 0.8);
            });
        }

        // Bouncy boing sound
        function playBoing() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, now);
            osc.frequency.exponentialRampToValueAtTime(150, now + 0.15);
            osc.frequency.exponentialRampToValueAtTime(200, now + 0.25);

            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.3);
        }

        // Cute sheep baa
        function playBaa() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Main bleat tone
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            const filter = audioCtx.createBiquadFilter();

            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(220, now);
            osc.frequency.linearRampToValueAtTime(280, now + 0.1);
            osc.frequency.linearRampToValueAtTime(200, now + 0.3);

            filter.type = 'lowpass';
            filter.frequency.setValueAtTime(800, now);

            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(0.15, now + 0.05);
            gain.gain.linearRampToValueAtTime(0.1, now + 0.2);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.4);

            osc.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.4);
        }

        // Magical sparkle
        function playSparkle() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const notes = [880, 1108.73, 1318.51, 1567.98, 2093];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.05);
                gain.gain.linearRampToValueAtTime(0.08, now + i * 0.05 + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.05);
                osc.stop(now + i * 0.05 + 0.3);
            });
        }

        // Soft whoosh
        function playWhoosh() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const bufferSize = audioCtx.sampleRate * 0.3;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
            }

            const noise = audioCtx.createBufferSource();
            const filter = audioCtx.createBiquadFilter();
            const gain = audioCtx.createGain();

            noise.buffer = buffer;
            filter.type = 'bandpass';
            filter.frequency.setValueAtTime(1000, now);
            filter.frequency.exponentialRampToValueAtTime(300, now + 0.3);
            filter.Q.setValueAtTime(1, now);

            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(audioCtx.destination);
            noise.start(now);
        }

        // Quick pop
        function playPop() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(200, now + 0.1);

            gain.gain.setValueAtTime(0.2, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);

            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.1);
        }

        // Celebration chord
        function playCelebration() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Warm major chord (C E G C)
            const freqs = [261.63, 329.63, 392.00, 523.25];
            freqs.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.12, now + 0.1);
                gain.gain.setValueAtTime(0.12, now + 0.8);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 2);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 2);
            });
        }

        // Gentle lullaby loop
        function startLullaby() {
            if (!soundEnabled || !audioCtx) return;

            // Pentatonic melody notes (C D E G A)
            const melody = [261.63, 293.66, 329.63, 392.00, 440.00, 392.00, 329.63, 293.66];
            let noteIndex = 0;

            function playNote() {
                if (!soundEnabled || !audioCtx) {
                    stopLullaby();
                    return;
                }
                const now = audioCtx.currentTime;
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();

                osc.type = 'sine';
                osc.frequency.setValueAtTime(melody[noteIndex], now);

                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.06, now + 0.1);
                gain.gain.setValueAtTime(0.06, now + 0.4);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 0.8);

                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 0.8);

                noteIndex = (noteIndex + 1) % melody.length;
            }

            playNote();
            lullabyInterval = setInterval(playNote, 800);
        }

        function stopLullaby() {
            if (lullabyInterval) {
                clearInterval(lullabyInterval);
                lullabyInterval = null;
            }
        }

        // ============ AMBIENT SOUNDS ============
        // Cozy night atmosphere with soft breeze

        function startAmbientSounds() {
            if (!soundEnabled || !audioCtx || ambientPlaying) return;
            ambientPlaying = true;

            // Start soft wind/breeze
            startWind();
        }

        function stopAmbientSounds() {
            ambientPlaying = false;

            // Stop wind
            if (windGain) {
                const now = audioCtx ? audioCtx.currentTime : 0;
                windGain.gain.exponentialRampToValueAtTime(0.001, now + 0.5);
                setTimeout(() => {
                    if (windNode) {
                        windNode.stop();
                        windNode = null;
                    }
                    windGain = null;
                }, 600);
            }
        }

        function startWind() {
            if (!soundEnabled || !audioCtx) return;

            // Create gentle wind using filtered noise
            const bufferSize = audioCtx.sampleRate * 4;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            // Create smooth noise
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }

            windNode = audioCtx.createBufferSource();
            windNode.buffer = buffer;
            windNode.loop = true;

            // Multiple filters for soft, dreamy wind
            const lowpass = audioCtx.createBiquadFilter();
            lowpass.type = 'lowpass';
            lowpass.frequency.setValueAtTime(400, audioCtx.currentTime);
            lowpass.Q.setValueAtTime(1, audioCtx.currentTime);

            const highpass = audioCtx.createBiquadFilter();
            highpass.type = 'highpass';
            highpass.frequency.setValueAtTime(100, audioCtx.currentTime);

            windGain = audioCtx.createGain();
            windGain.gain.setValueAtTime(0.001, audioCtx.currentTime);
            windGain.gain.exponentialRampToValueAtTime(0.025, audioCtx.currentTime + 2);

            // Gentle volume modulation for breathing wind effect
            const lfo = audioCtx.createOscillator();
            const lfoGain = audioCtx.createGain();
            lfo.type = 'sine';
            lfo.frequency.setValueAtTime(0.15, audioCtx.currentTime); // Very slow modulation
            lfoGain.gain.setValueAtTime(0.008, audioCtx.currentTime);

            lfo.connect(lfoGain);
            lfoGain.connect(windGain.gain);

            windNode.connect(lowpass);
            lowpass.connect(highpass);
            highpass.connect(windGain);
            windGain.connect(audioCtx.destination);

            windNode.start();
            lfo.start();
        }

        // ============ INITIALIZATION ============
        function init() {
            createStars();
            startShootingStars();
            updateSoundIcon();
        }

        function createStars() {
            const container = document.getElementById('stars');
            const starCount = 80;

            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 70 + '%';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.setProperty('--duration', (Math.random() * 3 + 2) + 's');
                star.style.setProperty('--delay', (Math.random() * 5) + 's');
                container.appendChild(star);
            }
        }

        // ============ SHOOTING STARS ============
        function startShootingStars() {
            // Spawn a shooting star every 3-8 seconds
            function scheduleNext() {
                const delay = 3000 + Math.random() * 5000;
                setTimeout(() => {
                    createShootingStar();
                    scheduleNext();
                }, delay);
            }
            // Start with one after a short delay
            setTimeout(createShootingStar, 2000);
            scheduleNext();
        }

        function createShootingStar() {
            const container = document.getElementById('stars');
            const star = document.createElement('div');
            star.className = 'shooting-star';

            // Random starting position (upper-left portion of sky)
            star.style.left = (5 + Math.random() * 50) + '%';
            star.style.top = (5 + Math.random() * 25) + '%';

            // Random properties for variety
            const duration = 0.6 + Math.random() * 0.5;
            const distance = 300 + Math.random() * 300;
            const tailLength = 80 + Math.random() * 80;
            const angle = 25 + Math.random() * 30; // 25 to 55 degrees (diagonal down-right)

            star.style.setProperty('--duration', duration + 's');
            star.style.setProperty('--distance', distance + 'px');
            star.style.setProperty('--tail-length', tailLength + 'px');
            star.style.setProperty('--angle', angle + 'deg');

            container.appendChild(star);

            // Remove after animation completes
            setTimeout(() => star.remove(), duration * 1000 + 100);
        }

        // ============ GAME FLOW ============

        // Animation patterns with their properties
        const PATTERNS = [
            { name: 'sheepJumpLeft', duration: [2.5, 3.5], easing: 'ease-in-out', flip: 1 },
            { name: 'sheepJumpRight', duration: [2.5, 3.5], easing: 'ease-in-out', flip: -1 },
            { name: 'sheepBounce', duration: [3, 4], easing: 'ease-in-out', flip: 1 },
            { name: 'sheepDash', duration: [1.5, 2.2], easing: 'ease-out', flip: 1 },
            { name: 'sheepZigzag', duration: [3, 4], easing: 'linear', flip: 1 },
            { name: 'sheepFloat', duration: [3.5, 4.5], easing: 'ease-in-out', flip: 1 },
        ];

        let lastPatternIndex = -1; // Track last used pattern to avoid repeats

        function startGame() {
            initAudio();
            playChime();
            startAmbientSounds();
            document.getElementById('title-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            gameStarted = true;

            // Spawn first sheep
            setTimeout(spawnSheep, 500);
        }

        function spawnSheep() {
            if (!gameStarted || sheepCaught >= TOTAL_SHEEP_NEEDED) return;

            const sheepArea = document.getElementById('sheep-area');
            const sheepId = sheepIdCounter++;

            // Pick a random pattern (avoid repeating the same one)
            let patternIndex;
            do {
                patternIndex = Math.floor(Math.random() * PATTERNS.length);
            } while (patternIndex === lastPatternIndex && PATTERNS.length > 1);
            lastPatternIndex = patternIndex;

            const pattern = PATTERNS[patternIndex];

            // Randomize within the pattern's ranges
            const duration = pattern.duration[0] + Math.random() * (pattern.duration[1] - pattern.duration[0]);
            const startY = 22 + Math.random() * 10;    // 22-32%
            const peakY = 55 + Math.random() * 20;     // 55-75%
            const endY = 22 + Math.random() * 10;      // 22-32%
            const size = 0.85 + Math.random() * 0.3;   // 0.85-1.15 scale

            // Create sheep element
            const sheepContainer = document.createElement('div');
            sheepContainer.className = 'sheep-container';
            sheepContainer.dataset.sheepId = sheepId;

            // Set CSS custom properties
            sheepContainer.style.setProperty('--animation-name', pattern.name);
            sheepContainer.style.setProperty('--duration', duration + 's');
            sheepContainer.style.setProperty('--easing', pattern.easing);
            sheepContainer.style.setProperty('--start-y', startY + '%');
            sheepContainer.style.setProperty('--peak-y', peakY + '%');
            sheepContainer.style.setProperty('--end-y', endY + '%');
            sheepContainer.style.setProperty('--size', size);
            sheepContainer.style.setProperty('--flip', pattern.flip);

            // Sheep SVG
            sheepContainer.innerHTML = `
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="75" cy="35" rx="15" ry="13" fill="#fafafa"/>
                            <ellipse cx="90" cy="38" rx="12" ry="11" fill="#f0f0f0"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="75" cy="42" rx="16" ry="14" fill="#f8f8f8"/>
                            <ellipse cx="60" cy="55" rx="20" ry="14" fill="#f5f5f5"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="68" cy="30" rx="12" ry="10" fill="#fafafa"/>
                            <ellipse cx="80" cy="32" rx="10" ry="9" fill="#f8f8f8"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                            <ellipse cx="38" cy="38" rx="10" ry="9" fill="#fafafa"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <ellipse cx="105" cy="45" rx="7" ry="6" fill="#fafafa"/>
                        <g class="legs">
                            <path d="M78 62 L80 80 L76 80 L74 62" fill="#3d3d3d"/>
                            <ellipse cx="78" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M68 63 L70 80 L66 80 L64 63" fill="#3d3d3d"/>
                            <ellipse cx="68" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M52 60 L54 80 L50 80 L48 60" fill="#3d3d3d"/>
                            <ellipse cx="52" cy="80" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M42 58 L44 78 L40 78 L38 58" fill="#3d3d3d"/>
                            <ellipse cx="42" cy="78" rx="3" ry="2" fill="#2d2d2d"/>
                        </g>
                        <g class="head">
                            <ellipse cx="18" cy="28" rx="8" ry="5" fill="#4a4a4a" transform="rotate(-30 18 28)"/>
                            <ellipse cx="38" cy="22" rx="8" ry="5" fill="#4a4a4a" transform="rotate(30 38 22)"/>
                            <ellipse cx="18" cy="28" rx="5" ry="3" fill="#ffb6c1" transform="rotate(-30 18 28)"/>
                            <ellipse cx="38" cy="22" rx="5" ry="3" fill="#ffb6c1" transform="rotate(30 38 22)"/>
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <ellipse cx="22" cy="28" rx="8" ry="6" fill="#fafafa"/>
                            <ellipse cx="34" cy="28" rx="8" ry="6" fill="#fafafa"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="28" cy="48" rx="3" ry="2" fill="#2d2d2d"/>
                            <path d="M25 52 Q28 55 31 52" stroke="#2d2d2d" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                        </g>
                    </svg>
                </div>
            `;

            // Click handler
            sheepContainer.addEventListener('click', () => catchSheep(sheepContainer, sheepId));

            // Track this sheep
            activeSheep.set(sheepId, sheepContainer);

            // Add to DOM
            sheepArea.appendChild(sheepContainer);
            playBoing();

            // Handle animation end (sheep escaped)
            sheepContainer.addEventListener('animationend', () => {
                if (!sheepContainer.classList.contains('caught')) {
                    sheepContainer.classList.add('escaped');
                    activeSheep.delete(sheepId);
                    setTimeout(() => {
                        sheepContainer.remove();
                        // Spawn next sheep after a short delay
                        if (gameStarted && sheepCaught < TOTAL_SHEEP_NEEDED) {
                            setTimeout(spawnSheep, 400);
                        }
                    }, 100);
                }
            });
        }

        function catchSheep(sheepElement, sheepId) {
            // Prevent double-catching
            if (sheepElement.classList.contains('caught') || sheepCaught >= TOTAL_SHEEP_NEEDED) return;

            // Get position BEFORE stopping animation
            const rect = sheepElement.getBoundingClientRect();

            // Fix the sheep's position where it was caught
            sheepElement.style.left = rect.left + 'px';
            sheepElement.style.top = rect.top + 'px';
            sheepElement.style.bottom = 'auto';
            sheepElement.style.right = 'auto';
            sheepElement.style.position = 'fixed';
            sheepElement.style.animation = 'sheepPoof 0.4s ease forwards';

            sheepElement.classList.add('caught');
            activeSheep.delete(sheepId);

            // Play sounds
            playBaa();
            setTimeout(playSparkle, 100);

            // Hearts burst at caught position
            createHeartsBurst(rect.left + rect.width/2, rect.top + rect.height/2);

            // Update count
            sheepCaught++;
            document.getElementById('sheep-count').textContent = sheepCaught;

            // Remove sheep after poof animation
            setTimeout(() => {
                sheepElement.remove();

                // Show message
                if (sheepCaught <= messages.length) {
                    showMessage(messages[sheepCaught - 1]);
                }
            }, 400);
        }


        function createHeartsBurst(x, y) {
            const hearts = ['ðŸ’•', 'ðŸ’—', 'ðŸ’–', 'âœ¨', 'ðŸ’œ', 'ðŸ¤'];
            const container = document.getElementById('game-screen');

            for (let i = 0; i < 10; i++) {
                const heart = document.createElement('div');
                heart.className = 'burst-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.position = 'fixed';
                heart.style.left = x + 'px';
                heart.style.top = y + 'px';

                const angle = (i / 10) * Math.PI * 2;
                const distance = 60 + Math.random() * 60;
                heart.style.setProperty('--tx', Math.cos(angle) * distance + 'px');
                heart.style.setProperty('--ty', Math.sin(angle) * distance + 'px');

                container.appendChild(heart);
                setTimeout(() => heart.remove(), 1000);
            }
        }

        function showMessage(text) {
            const card = document.getElementById('message-card');
            const messageText = document.getElementById('message-text');
            messageText.textContent = text;
            card.classList.add('show');
            playWhoosh();
        }

        function nextSheep() {
            playPop();
            const card = document.getElementById('message-card');
            card.classList.remove('show');

            // Check if game is complete
            if (sheepCaught >= TOTAL_SHEEP_NEEDED) {
                setTimeout(showFinalScreen, 300);
            } else {
                // Spawn next sheep
                setTimeout(spawnSheep, 300);
            }
        }

        function showFinalScreen() {
            // Clear any remaining sheep
            document.getElementById('sheep-area').innerHTML = '';
            activeSheep.clear();

            // Transition to Stage 2 instead of final screen
            document.getElementById('game-screen').classList.remove('active');
            startStage2();
        }

        function createFloatingHearts() {
            const container = document.getElementById('floating-hearts');
            const hearts = ['ðŸ’•', 'ðŸ’—', 'ðŸ’–', 'ðŸ’œ', 'ðŸ¤'];

            for (let i = 0; i < 15; i++) {
                const heart = document.createElement('div');
                heart.className = 'floating-heart';
                heart.textContent = hearts[Math.floor(Math.random() * hearts.length)];
                heart.style.left = Math.random() * 100 + '%';
                heart.style.animationDelay = Math.random() * 8 + 's';
                heart.style.fontSize = (15 + Math.random() * 15) + 'px';
                container.appendChild(heart);
            }
        }

        function replay() {
            // Stop sounds
            stopLullaby();
            stopAmbientSounds();
            playPop();

            // Clear sheep
            document.getElementById('sheep-area').innerHTML = '';
            activeSheep.clear();

            // Reset Stage 1 state
            sheepCaught = 0;
            gameStarted = false;
            sheepIdCounter = 0;
            lastPatternIndex = -1;
            document.getElementById('sheep-count').textContent = '0';
            document.getElementById('floating-hearts').innerHTML = '';

            // Hide message card if visible
            document.getElementById('message-card').classList.remove('show');

            // Reset Stage 2
            resetStage2();

            // Switch screens (hide all, show title)
            document.getElementById('final-screen').classList.remove('active');
            document.getElementById('phone-stage').classList.remove('active');
            document.getElementById('game-screen').classList.remove('active');
            document.getElementById('title-screen').classList.add('active');
        }

        // ============ STAGE 2: PHONE CHARGING MINI-GAME ============

        // Stage 2 State
        let stage2Phase = 'idle'; // idle, wakeup, search, charging, calling, complete
        let callAttempts = 0;
        const MAX_CALL_ATTEMPTS = 3;
        let searchedItems = new Set();

        // Search feedback messages for wrong items
        const searchFeedback = {
            lamp: "Not under the lamp...",
            book: "Nope, just a book...",
            slippers: "Just my slippers...",
            plant: "Behind the plant? No...",
            clothes: "Not in my clothes...",
            charger: "Found it!"
        };

        // Sad messages during charging
        const chargingMessages = [
            "Cristal turns over in bed, reaching for her phone...",
            "She wonders why it got so quiet...",
            "The silence feels wrong without your voice...",
            "She pulls the blanket closer, feeling alone...",
            "Her phone shows 'Call Ended'...",
            "She waits, hoping you'll call back..."
        ];

        // No answer messages
        const noAnswerMessages = [
            "No answer... she must be in deep sleep ðŸ˜¢",
            "Still no answer... please pick up...",
            "She didn't hear it... I'm so sorry, Cristal..."
        ];

        // Stage 2 Sound Effects
        function playAlarm() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Jarring wake-up beeps
            for (let i = 0; i < 3; i++) {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'square';
                osc.frequency.setValueAtTime(800, now + i * 0.15);
                gain.gain.setValueAtTime(0.1, now + i * 0.15);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.15 + 0.1);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.15);
                osc.stop(now + i * 0.15 + 0.1);
            }
        }

        function playPhoneDie() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Sad descending tone
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(100, now + 0.8);
            gain.gain.setValueAtTime(0.15, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.8);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.8);
        }

        function playSearchTap() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(300, now);
            gain.gain.setValueAtTime(0.1, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.1);
        }

        function playFoundCharger() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Happy ascending ding
            [400, 500, 600, 800].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.08);
                gain.gain.linearRampToValueAtTime(0.12, now + i * 0.08 + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.08 + 0.3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.08);
                osc.stop(now + i * 0.08 + 0.3);
            });
        }

        function playCharging() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, now);
            osc.frequency.setValueAtTime(700, now + 0.1);
            gain.gain.setValueAtTime(0.08, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start(now);
            osc.stop(now + 0.2);
        }

        function playRinging() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Phone ring tone
            for (let i = 0; i < 2; i++) {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(440, now + i * 0.3);
                osc.frequency.setValueAtTime(480, now + i * 0.3 + 0.15);
                gain.gain.setValueAtTime(0.1, now + i * 0.3);
                gain.gain.setValueAtTime(0.1, now + i * 0.3 + 0.25);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.3 + 0.28);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.3);
                osc.stop(now + i * 0.3 + 0.3);
            }
        }

        function playNoAnswer() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Sad disconnection tone
            [400, 350, 300].forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now + i * 0.2);
                gain.gain.linearRampToValueAtTime(0.1, now + i * 0.2 + 0.02);
                gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.2 + 0.18);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now + i * 0.2);
                osc.stop(now + i * 0.2 + 0.2);
            });
        }

        function playSadChord() {
            if (!soundEnabled || !audioCtx) return;
            const now = audioCtx.currentTime;

            // Minor chord (sad)
            const freqs = [220, 261.63, 329.63];
            freqs.forEach((freq) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(freq, now);
                gain.gain.setValueAtTime(0, now);
                gain.gain.linearRampToValueAtTime(0.08, now + 0.1);
                gain.gain.setValueAtTime(0.08, now + 1.5);
                gain.gain.exponentialRampToValueAtTime(0.001, now + 3);
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.start(now);
                osc.stop(now + 3);
            });
        }

        // Start Stage 2
        function startStage2() {
            document.getElementById('phone-stage').classList.add('active');
            stage2Phase = 'wakeup';
            stopAmbientSounds();

            // Phase A: Wake up animation
            setTimeout(runWakeUpPhase, 500);
        }

        // Phase A: Wake up and see dead phone
        function runWakeUpPhase() {
            const phoneScreen = document.getElementById('phone-screen');

            // Phone dies animation
            phoneScreen.classList.add('dying');
            playPhoneDie();

            // After phone dies, show alert
            setTimeout(() => {
                phoneScreen.classList.remove('dying');
                phoneScreen.classList.add('dead');
                phoneScreen.querySelector('.phone-battery-icon').textContent = 'ðŸ’€';

                // Wake up alert
                setTimeout(() => {
                    document.getElementById('wake-up-alert').classList.add('show');
                    playAlarm();

                    // Stop sleeper's zzz animation
                    const sleeper = document.getElementById('sleeper');
                    sleeper.querySelectorAll('.sleeper-zzz').forEach(z => z.style.animation = 'none');

                    // Transition to search phase
                    setTimeout(() => {
                        document.getElementById('wake-up-alert').classList.remove('show');
                        runSearchPhase();
                    }, 2000);
                }, 500);
            }, 2000);
        }

        // Phase B: Search for charger
        function runSearchPhase() {
            stage2Phase = 'search';
            document.getElementById('search-prompt').classList.add('show');

            // Set up click handlers for searchable items
            document.querySelectorAll('.searchable').forEach(item => {
                item.addEventListener('click', handleSearchClick);
            });
        }

        function handleSearchClick(e) {
            if (stage2Phase !== 'search') return;

            const item = e.currentTarget;
            const itemType = item.dataset.item;

            if (searchedItems.has(itemType)) return;
            searchedItems.add(itemType);

            playSearchTap();

            // Show feedback
            const feedback = document.getElementById('search-feedback');
            feedback.textContent = searchFeedback[itemType];
            feedback.classList.add('show');

            setTimeout(() => {
                feedback.classList.remove('show');
            }, 1500);

            if (itemType === 'charger') {
                // Found it!
                item.classList.add('searched', 'found');
                playFoundCharger();
                document.getElementById('search-prompt').classList.remove('show');

                setTimeout(() => {
                    runChargingPhase();
                }, 1500);
            } else {
                item.classList.add('searched');
            }
        }

        // Phase C: Charging with sad messages
        function runChargingPhase() {
            stage2Phase = 'charging';

            // Hide bedroom, show charging screen
            document.getElementById('charging-screen').classList.add('show');

            let currentPercent = 0;
            let messageIndex = 0;
            const batteryFill = document.getElementById('battery-fill');
            const batteryPercent = document.getElementById('battery-percent');
            const chargingMessage = document.getElementById('charging-message');

            // Charging animation
            const chargeInterval = setInterval(() => {
                currentPercent++;
                batteryFill.style.height = currentPercent + '%';
                batteryPercent.textContent = currentPercent;

                if (currentPercent <= 10) {
                    batteryFill.classList.add('low');
                } else {
                    batteryFill.classList.remove('low');
                }

                // Play charging sound occasionally
                if (currentPercent % 5 === 0) {
                    playCharging();
                }

                // Show messages at certain percentages
                if (currentPercent === 3 || currentPercent === 8 || currentPercent === 13 ||
                    currentPercent === 18 || currentPercent === 23 || currentPercent === 28) {
                    if (messageIndex < chargingMessages.length) {
                        chargingMessage.textContent = chargingMessages[messageIndex];
                        chargingMessage.classList.add('show');
                        messageIndex++;

                        setTimeout(() => {
                            chargingMessage.classList.remove('show');
                        }, 2500);
                    }
                }

                // Stop at 35% - enough to make a call
                if (currentPercent >= 35) {
                    clearInterval(chargeInterval);

                    setTimeout(() => {
                        chargingMessage.textContent = "Finally! Enough to make a call...";
                        chargingMessage.classList.add('show');
                        playSparkle();

                        setTimeout(() => {
                            chargingMessage.classList.remove('show');
                            document.getElementById('charging-screen').classList.remove('show');
                            runCallingPhase();
                        }, 2000);
                    }, 500);
                }
            }, 150); // Speed of charging
        }

        // Phase D: Calling with no answer
        function runCallingPhase() {
            stage2Phase = 'calling';
            callAttempts = 0;

            document.getElementById('calling-screen').classList.add('show');
            startCallAttempt();
        }

        function startCallAttempt() {
            const callStatus = document.getElementById('call-status');
            const noAnswerMsg = document.getElementById('no-answer-msg');
            const retryBtn = document.getElementById('retry-call-btn');
            const endBtn = document.getElementById('end-call-btn');

            callStatus.textContent = 'Calling...';
            callStatus.classList.add('ringing');
            noAnswerMsg.classList.remove('show');
            retryBtn.style.display = 'none';
            endBtn.style.display = 'flex';

            // Play ringing sounds
            let ringCount = 0;
            const ringInterval = setInterval(() => {
                playRinging();
                ringCount++;

                if (ringCount >= 4) {
                    clearInterval(ringInterval);
                    // No answer
                    callStatus.classList.remove('ringing');
                    callStatus.textContent = 'No answer';
                    playNoAnswer();

                    callAttempts++;

                    setTimeout(() => {
                        noAnswerMsg.textContent = noAnswerMessages[Math.min(callAttempts - 1, noAnswerMessages.length - 1)];
                        noAnswerMsg.classList.add('show');

                        if (callAttempts < MAX_CALL_ATTEMPTS) {
                            retryBtn.style.display = 'flex';
                            endBtn.style.display = 'none';
                        } else {
                            // Final attempt failed
                            setTimeout(() => {
                                endStage2();
                            }, 2500);
                        }
                    }, 500);
                }
            }, 1200);
        }

        function retryCall() {
            playPop();
            startCallAttempt();
        }

        function endCallAttempt() {
            playPop();
            endStage2();
        }

        function endStage2() {
            stage2Phase = 'complete';

            // Show morning light
            document.getElementById('morning-light').classList.add('rising');

            // Hide calling screen
            document.getElementById('calling-screen').classList.remove('show');

            // Show transition message
            const transition = document.getElementById('stage-transition');
            const transitionText = document.getElementById('stage-transition-text');
            transitionText.innerHTML = "She slept alone that night...<br>cold and sad...<br>waiting for a call that never came...";
            transition.classList.add('show');

            playSadChord();

            // Transition to final screen
            setTimeout(() => {
                transition.classList.remove('show');
                document.getElementById('phone-stage').classList.remove('active');
                document.getElementById('final-screen').classList.add('active');
                createFloatingHearts();
                playCelebration();
                setTimeout(startLullaby, 2000);
            }, 5000);
        }

        // Reset Stage 2 state
        function resetStage2() {
            stage2Phase = 'idle';
            callAttempts = 0;
            searchedItems.clear();

            // Reset phone
            const phoneScreen = document.getElementById('phone-screen');
            phoneScreen.classList.remove('dying', 'dead');
            phoneScreen.querySelector('.phone-battery-icon').textContent = 'ðŸ”‹';

            // Reset sleeper
            const sleeper = document.getElementById('sleeper');
            sleeper.querySelectorAll('.sleeper-zzz').forEach(z => z.style.animation = '');

            // Reset UI elements
            document.getElementById('wake-up-alert').classList.remove('show');
            document.getElementById('search-prompt').classList.remove('show');
            document.getElementById('search-feedback').classList.remove('show');
            document.getElementById('charging-screen').classList.remove('show');
            document.getElementById('calling-screen').classList.remove('show');
            document.getElementById('stage-transition').classList.remove('show');
            document.getElementById('morning-light').classList.remove('rising');

            // Reset searchable items
            document.querySelectorAll('.searchable').forEach(item => {
                item.classList.remove('searched', 'found');
            });

            // Reset battery
            document.getElementById('battery-fill').style.height = '0%';
            document.getElementById('battery-fill').classList.add('low');
            document.getElementById('battery-percent').textContent = '0';
            document.getElementById('charging-message').classList.remove('show');

            // Reset call screen
            document.getElementById('call-status').textContent = 'Calling...';
            document.getElementById('call-status').classList.remove('ringing');
            document.getElementById('no-answer-msg').classList.remove('show');
            document.getElementById('retry-call-btn').style.display = 'none';
            document.getElementById('end-call-btn').style.display = 'flex';
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
