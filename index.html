<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>For Cristal</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/sheep-game.css">
    <link rel="stylesheet" href="css/phone-game.css">
    <link rel="stylesheet" href="css/puzzle-game.css">
</head>
<body>
    <!-- Stars Background -->
    <div class="stars-container" id="stars"></div>

    <!-- Moon -->
    <div class="moon"></div>

    <!-- Sound Toggle -->
    <button class="sound-toggle" id="sound-toggle" onclick="toggleSound()">
        <span id="sound-icon">ðŸ”Š</span>
    </button>

    <!-- ============ TITLE SCREEN ============ -->
    <div class="scene active" id="title-screen">
        <div class="zzz-container">
            <div class="zzz">Z</div>
            <div class="zzz">z</div>
            <div class="zzz">z</div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-photo.jpg"> -->
        <div class="title-photo">
            <span>ðŸ’‘</span>
        </div>

        <h1 class="main-title">A Bedtime Apology for Cristal</h1>
        <p class="subtitle">Tap to help me count my sorries...</p>

        <button class="start-btn" onclick="startGame()">Start</button>
    </div>

    <!-- ============ GAME SCREEN ============ -->
    <div class="scene" id="game-screen">
        <div class="progress-counter">
            <span id="sheep-count">0</span> of 8 sheep counted
        </div>

        <!-- Fence -->
        <div class="fence">
            <div class="fence-post">
                <div class="fence-rail top"></div>
                <div class="fence-rail bottom"></div>
            </div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
            <div class="fence-post"></div>
        </div>

        <!-- Ground -->
        <div class="ground"></div>

        <!-- Sheep spawn area (sheep created dynamically via JS) -->
        <div class="sheep-area" id="sheep-area"></div>

        <!-- Message Card -->
        <div class="message-card" id="message-card">
            <p class="message-text" id="message-text"></p>
            <button class="next-btn" onclick="nextSheep()">Next Sheep</button>
        </div>
    </div>

    <!-- ============ STAGE 2: PHONE CHARGING ============ -->
    <div class="scene" id="phone-stage">
        <!-- Call Dying Intro Screen -->
        <div class="call-dying-screen" id="call-dying-screen">
            <div class="call-active-phone">
                <div class="call-screen-content">
                    <div class="call-contact-photo-big">ðŸ’•</div>
                    <div class="call-contact-name-big">Cristal</div>
                    <div class="call-timer" id="call-timer">02:47:13</div>
                    <div class="call-active-indicator">
                        <div class="call-active-dot"></div>
                        <span>Connected</span>
                    </div>
                    <div class="low-battery-warning" id="low-battery-warning">
                        <span>ðŸª«</span>
                        <span>Low Battery - 3%</span>
                    </div>
                </div>
                <div class="phone-dying-overlay" id="phone-dying-overlay">
                    <span class="dead-icon">ðŸ“µ</span>
                </div>
            </div>
            <div class="call-disconnected-msg" id="call-disconnected-msg">
                Call Disconnected<br>
                <small>Battery depleted</small>
            </div>
        </div>

        <div class="bedroom">
            <!-- Room structure -->
            <div class="room-wall"></div>
            <div class="room-floor"></div>
            <div class="room-baseboard"></div>

            <!-- Morning light overlay -->
            <div class="morning-light" id="morning-light"></div>

            <!-- Moonlight glow -->
            <div class="moonlight"></div>

            <!-- Wall poster/art -->
            <div class="wall-poster">
                <div class="poster-art"></div>
            </div>

            <!-- Wall shelf with items -->
            <div class="wall-shelf"></div>
            <div class="shelf-items">
                <div class="shelf-book"></div>
                <div class="shelf-book"></div>
                <div class="shelf-frame"></div>
            </div>

            <!-- Bedroom rug -->
            <div class="bedroom-rug"></div>

            <!-- Window with stars, moon, and curtains -->
            <div class="bedroom-window">
                <div class="window-curtain left"></div>
                <div class="window-curtain right"></div>
                <div class="window-divider"></div>
                <div class="window-moon"></div>
                <div class="window-stars">
                    <div class="window-star" style="top: 25%; left: 20%;"></div>
                    <div class="window-star bright" style="top: 35%; left: 50%;"></div>
                    <div class="window-star" style="top: 10%; left: 70%;"></div>
                    <div class="window-star" style="top: 55%; left: 15%;"></div>
                    <div class="window-star" style="top: 65%; left: 60%;"></div>
                    <div class="window-star bright" style="top: 75%; left: 35%;"></div>
                    <div class="window-star" style="top: 45%; left: 80%;"></div>
                </div>
            </div>

            <!-- Bed with sleeper -->
            <div class="bed">
                <div class="bed-frame">
                    <div class="bed-leg"></div>
                    <div class="bed-leg"></div>
                </div>
                <div class="mattress"></div>
                <div class="blanket"></div>
                <div class="body-bump-torso"></div>
                <div class="body-bump-legs"></div>
                <div class="feet-bump"></div>
                <div class="pillow"></div>
                <div class="sleeper" id="sleeper">
                    <div class="sleeper-head">
                        <div class="sleeper-hair"></div>
                        <div class="sleeper-eyes">
                            <div class="sleeper-eye"></div>
                            <div class="sleeper-eye"></div>
                        </div>
                    </div>
                    <div class="sleeper-shoulder"></div>
                    <div class="sleeper-zzz">Z</div>
                    <div class="sleeper-zzz">z</div>
                    <div class="sleeper-zzz">z</div>
                </div>
            </div>

            <!-- Nightstand with phone -->
            <div class="nightstand">
                <div class="nightstand-drawer"></div>
                <div class="phone-on-stand" id="phone-on-stand">
                    <div class="phone-screen-glow" id="phone-screen">
                        <span class="phone-battery-icon">ðŸ”‹</span>
                    </div>
                </div>
            </div>

            <!-- Searchable objects -->
            <div class="searchable desk-lamp" data-item="lamp" id="search-lamp">
                <div class="lamp-shade"></div>
                <div class="lamp-stem"></div>
                <div class="lamp-base"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable floor-book" data-item="book" id="search-book">
                <div class="search-glow"></div>
            </div>

            <div class="searchable slippers" data-item="slippers" id="search-slippers">
                <div class="slipper">
                    <div class="slipper-sole"></div>
                    <div class="slipper-upper"></div>
                    <div class="slipper-opening"></div>
                </div>
                <div class="slipper">
                    <div class="slipper-sole"></div>
                    <div class="slipper-upper"></div>
                    <div class="slipper-opening"></div>
                </div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable plant" data-item="plant" id="search-plant">
                <div class="plant-leaves">
                    <div class="plant-stem"></div>
                    <div class="plant-leaf"></div>
                    <div class="plant-leaf"></div>
                    <div class="plant-leaf"></div>
                    <div class="plant-leaf"></div>
                    <div class="plant-leaf"></div>
                </div>
                <div class="plant-pot"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable clothes-pile" data-item="clothes" id="search-clothes">
                <div class="clothes-jeans"></div>
                <div class="clothes-hoodie"></div>
                <div class="clothes-shirt"></div>
                <div class="clothes-sock"></div>
                <div class="search-glow"></div>
            </div>

            <div class="searchable charger-spot" data-item="charger" id="search-charger">
                <div class="charger-cable"></div>
                <div class="charger-plug"></div>
                <div class="search-glow"></div>
            </div>

            <!-- Wake up alert -->
            <div class="wake-up-alert" id="wake-up-alert">!! OH NO !!</div>

            <!-- Search prompt -->
            <div class="search-prompt" id="search-prompt">
                Find the charger! Tap around the room...
            </div>

            <!-- Search feedback -->
            <div class="search-feedback" id="search-feedback"></div>
        </div>

        <!-- Charging mini-game screen -->
        <div class="charging-screen" id="charging-screen">
            <div class="charging-game-area" id="charging-game-area">
                <!-- HUD -->
                <div class="charging-hud">
                    <div class="charging-hud-battery">
                        <div class="hud-battery-icon">
                            <div class="hud-battery-fill" id="hud-battery-fill"></div>
                        </div>
                        <span class="hud-percent"><span id="battery-percent">0</span>%</span>
                    </div>
                    <div class="charging-instruction">Catch the falling energy! Avoid red surges!</div>
                </div>

                <!-- Power source at top -->
                <div class="power-glow"></div>
                <div class="power-source"></div>

                <!-- Floor area -->
                <div class="game-floor"></div>

                <!-- Orbs spawn here -->
                <div class="orbs-container" id="orbs-container"></div>

                <!-- Draggable phone -->
                <div class="catcher-phone" id="catcher-phone">
                    <span class="catcher-battery">ðŸ”‹</span>
                </div>

                <!-- Charging complete overlay -->
                <div class="charging-complete" id="charging-complete">
                    <div class="charging-complete-text">Charged!</div>
                    <div class="charging-complete-sub">Ready to make the call...</div>
                </div>
            </div>
            <div class="charging-message" id="charging-message"></div>
        </div>

        <!-- Calling screen overlay -->
        <div class="calling-screen" id="calling-screen">
            <div class="call-phone">
                <div class="contact-photo">ðŸ’•</div>
                <div class="contact-name">Cristal</div>
                <div class="call-status" id="call-status">Calling...</div>
                <div class="call-actions">
                    <button class="call-btn end-call" id="end-call-btn" onclick="endCallAttempt()">ðŸ“µ</button>
                    <button class="call-btn retry-call" id="retry-call-btn" onclick="retryCall()" style="display: none;">ðŸ“ž</button>
                </div>
            </div>
            <div class="no-answer-msg" id="no-answer-msg"></div>
        </div>

        <!-- Stage transition message -->
        <div class="stage-transition" id="stage-transition">
            <p class="stage-transition-text" id="stage-transition-text"></p>
        </div>
    </div>

    <!-- ============ STAGE 3: PUZZLE GAME ============ -->
    <div class="scene" id="puzzle-stage">
        <!-- Intro message -->
        <div class="puzzle-intro" id="puzzle-intro">
            <p>While I couldn't reach you...</p>
            <p>I kept thinking about us.</p>
            <p class="puzzle-instruction">Piece together this memory</p>
        </div>

        <!-- Puzzle container -->
        <div class="puzzle-container" id="puzzle-container">
            <div class="puzzle-grid" id="puzzle-grid">
                <!-- 15 tiles + 1 empty generated by JS -->
            </div>
            <div class="puzzle-controls">
                <div class="puzzle-moves">Moves: <span id="move-count">0</span></div>
                <button class="hint-btn" id="hint-btn">Hint</button>
            </div>
        </div>

        <!-- Hint overlay showing full image -->
        <div class="hint-overlay" id="hint-overlay">
            <img src="images/couple-photo.jpg" alt="Hint">
            <p>This is what you're building</p>
        </div>

        <!-- Completion overlay -->
        <div class="puzzle-complete" id="puzzle-complete">
            <div class="puzzle-complete-text">Every piece of us belongs together</div>
            <div class="puzzle-complete-sub">Just like we do.</div>
        </div>
    </div>

    <!-- ============ FINAL SCREEN ============ -->
    <div class="scene" id="final-screen">
        <div class="floating-hearts" id="floating-hearts"></div>

        <div class="sleeping-sheep-pile">
            <div class="mini-sheep" style="left: 0; top: 30px; transform: scale(0.4) rotate(-10deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 50px; top: 10px; transform: scale(0.45) rotate(5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 100px; top: 25px; transform: scale(0.38) rotate(-5deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 150px; top: 15px; transform: scale(0.42) rotate(8deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
            <div class="mini-sheep" style="left: 200px; top: 28px; transform: scale(0.4) rotate(-3deg);">
                <div class="sheep">
                    <svg viewBox="0 0 120 90" xmlns="http://www.w3.org/2000/svg">
                        <g class="wool-body">
                            <ellipse cx="85" cy="45" rx="18" ry="16" fill="#f5f5f5"/>
                            <ellipse cx="65" cy="48" rx="25" ry="20" fill="#ffffff"/>
                            <ellipse cx="55" cy="38" rx="18" ry="15" fill="#fafafa"/>
                            <ellipse cx="50" cy="32" rx="14" ry="12" fill="#ffffff"/>
                            <ellipse cx="42" cy="45" rx="15" ry="14" fill="#ffffff"/>
                        </g>
                        <ellipse cx="100" cy="48" rx="10" ry="9" fill="#f0f0f0"/>
                        <g class="head">
                            <ellipse cx="28" cy="38" rx="18" ry="16" fill="#3d3d3d"/>
                            <ellipse cx="28" cy="25" rx="12" ry="8" fill="#ffffff"/>
                            <path d="M20 38 Q23 42 26 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <path d="M30 38 Q33 42 36 38" stroke="#1a1a1a" stroke-width="2" fill="none"/>
                            <ellipse cx="17" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                            <ellipse cx="39" cy="44" rx="5" ry="3" fill="#ffb6c1" opacity="0.6"/>
                        </g>
                    </svg>
                </div>
            </div>
        </div>

        <!-- PHOTO PLACEHOLDER: Replace the span with an <img src="your-couple-photo.jpg"> -->
        <div class="final-photo">
            <span>ðŸ’•</span>
        </div>

        <div class="final-message">
            <h2 class="final-title">Cristal, mi amor...</h2>
            <p class="final-text">
                I'm so sorry you slept alone, cold and sad.
                <br>I never want you to feel that way again.
            </p>
            <div class="promises">
                <p class="promise-item">ðŸ”‹ I promise to always charge my phone</p>
                <p class="promise-item">ðŸ“± I promise to keep our call alive</p>
                <p class="promise-item">ðŸ’• I promise to be there when you wake up</p>
            </div>
            <p class="final-signature">Te amo siempre âœ¨</p>
        </div>

        <button class="replay-btn" onclick="replay()">Count sheep again?</button>
    </div>

    <!-- JavaScript Files (order matters!) -->
    <script src="js/audio.js"></script>
    <script src="js/sheep-game.js"></script>
    <script src="js/phone-game.js"></script>
    <script src="js/puzzle-game.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
